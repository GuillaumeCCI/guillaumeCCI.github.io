<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S√©lectionner les canaux de recrutement - Boulangeries Ange</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,500;0,9..40,700;1,9..40,400&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root{
      --vert-lime:#c8d223;
      --vert-fonce:#195850;
      --bleu-marine:#273c86;
      --blanc:#ffffff;
      --gris-clair:#f8f9fa;
      --gris-texte:#4a4a4a;
      --success:#22c55e;
      --warning:#f59e0b;
      --error:#ef4444;
    }

    html, body{
      width:100%;
      height:100%;
      font-family:'DM Sans', sans-serif;
      background:var(--blanc);
      color:var(--gris-texte);
      overflow:hidden;
    }

    .container{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
    }

    .header{
      background:var(--blanc);
      padding:16px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:3px solid var(--vert-lime);
      flex-shrink:0;
    }

    .logo-area{ display:flex; align-items:center; gap:16px; }
    .logo-badge{
      width:48px; height:48px;
      background:linear-gradient(135deg, var(--vert-lime) 0%, #a8b31e 100%);
      border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-size:24px;
      box-shadow:0 4px 12px rgba(200,210,35,.3);
    }
    .header-title{
      font-family:'Playfair Display', serif;
      font-size:1.4rem;
      color:var(--bleu-marine);
      font-weight:600;
    }

    .progress-area{ display:flex; align-items:center; gap:24px; }
    .progress-bar-container{
      width:200px; height:8px;
      background:var(--gris-clair);
      border-radius:4px;
      overflow:hidden;
    }
    .progress-bar{
      height:100%;
      background:linear-gradient(90deg, var(--vert-fonce), var(--vert-lime));
      border-radius:4px;
      transition:width .5s ease;
      width:0%;
    }
    .score-display{
      background:var(--gris-clair);
      padding:8px 20px;
      border-radius:24px;
      font-weight:500;
      color:var(--bleu-marine);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .score-icon{ color:var(--vert-lime); }

    .main-content{
      flex:1;
      display:flex;
      overflow:hidden;
      position:relative;
    }

    .screen{
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      display:none;
      flex-direction:column;
      opacity:0;
      transition:opacity .35s ease;
    }
    .screen.active{ display:flex; opacity:1; }

    .intro-screen{
      background:linear-gradient(135deg, var(--blanc) 0%, #f0f4e8 100%);
      justify-content:center;
      align-items:center;
      padding:40px;
    }
    .intro-card{ max-width:800px; text-align:center; }
    .intro-icon{
      width:100px; height:100px;
      background:linear-gradient(135deg, var(--vert-fonce) 0%, var(--bleu-marine) 100%);
      border-radius:24px;
      margin:0 auto 32px;
      display:flex; align-items:center; justify-content:center;
      font-size:48px;
      box-shadow:0 16px 40px rgba(25,88,80,.2);
    }
    .intro-title{
      font-family:'Playfair Display', serif;
      font-size:2.2rem;
      color:var(--bleu-marine);
      margin-bottom:16px;
    }
    .intro-subtitle{
      font-size:1.1rem;
      margin-bottom:32px;
      line-height:1.7;
    }
    .intro-context{
      background:var(--blanc);
      border-left:4px solid var(--vert-lime);
      padding:24px;
      text-align:left;
      margin-bottom:32px;
      border-radius:0 12px 12px 0;
      box-shadow:0 4px 20px rgba(0,0,0,.05);
    }
    .intro-context h3{
      color:var(--vert-fonce);
      margin-bottom:12px;
      font-size:1rem;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .intro-context p{ font-size:.95rem; line-height:1.6; }

    .btn{
      padding:16px 40px;
      border:none;
      border-radius:8px;
      font-family:'DM Sans', sans-serif;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:all .2s ease;
      user-select:none;
    }
    .btn-primary{
      background:linear-gradient(135deg, var(--vert-fonce) 0%, #1e6b61 100%);
      color:var(--blanc);
      box-shadow:0 4px 16px rgba(25,88,80,.3);
    }
    .btn-primary:hover{ transform:translateY(-2px); box-shadow:0 8px 24px rgba(25,88,80,.35); }

    /* Scenario */
    .scenario-screen{ display:flex; flex-direction:row; }
    .scenario-left{
      width:40%;
      background:linear-gradient(180deg, var(--bleu-marine) 0%, #1e2d5c 100%);
      padding:40px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      color:var(--blanc);
      position:relative;
      overflow:hidden;
    }
    .scenario-left::before{
      content:'';
      position:absolute;
      top:-50%;
      right:-50%;
      width:100%;
      height:100%;
      background:radial-gradient(circle, rgba(200,210,35,.1) 0%, transparent 70%);
      pointer-events:none;
    }
    .scenario-number{
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:2px;
      color:var(--vert-lime);
      margin-bottom:16px;
    }
    .scenario-title{
      font-family:'Playfair Display', serif;
      font-size:1.8rem;
      margin-bottom:24px;
      line-height:1.3;
    }
    .scenario-context{
      background:rgba(255,255,255,.1);
      padding:20px;
      border-radius:12px;
      margin-bottom:24px;
    }
    .context-item{
      display:flex;
      align-items:flex-start;
      gap:12px;
      margin-bottom:16px;
    }
    .context-item:last-child{ margin-bottom:0; }
    .context-icon{
      width:36px; height:36px;
      background:rgba(200,210,35,.2);
      border-radius:8px;
      display:flex; align-items:center; justify-content:center;
      flex-shrink:0;
      font-size:16px;
    }
    .context-label{
      font-size:.75rem;
      text-transform:uppercase;
      letter-spacing:1px;
      color:rgba(255,255,255,.7);
      margin-bottom:4px;
    }
    .context-value{ font-weight:500; font-size:.95rem; }

    .scenario-right{
      flex:1;
      padding:40px;
      display:flex;
      flex-direction:column;
      overflow-y:auto;
    }
    .question-prompt{
      font-size:1.1rem;
      color:var(--bleu-marine);
      margin-bottom:24px;
      font-weight:500;
    }

    .channels-grid{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:16px;
      margin-bottom:32px;
    }
    .channel-card{
      background:var(--blanc);
      border:2px solid #e5e7eb;
      border-radius:12px;
      padding:20px;
      cursor:pointer;
      transition:all .2s ease;
      position:relative;
    }
    .channel-card:hover{
      border-color:var(--vert-fonce);
      transform:translateY(-2px);
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }
    .channel-card.selected{
      border-color:var(--vert-fonce);
      background:linear-gradient(135deg, #f0f9f7 0%, #f8fdf8 100%);
    }
    .channel-card.selected::after{
      content:'‚úì';
      position:absolute;
      top:12px;
      right:12px;
      width:24px;
      height:24px;
      background:var(--vert-fonce);
      color:var(--blanc);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:14px;
      font-weight:700;
    }
    .channel-card.correct{ border-color:var(--success); background:#f0fdf4; }
    .channel-card.incorrect{ border-color:var(--error); background:#fef2f2; }
    .channel-card.missed{ border-color:var(--warning); background:#fffbeb; }

    .channel-icon{
      width:44px; height:44px;
      background:var(--gris-clair);
      border-radius:10px;
      display:flex; align-items:center; justify-content:center;
      margin-bottom:12px;
      font-size:20px;
    }
    .channel-name{ font-weight:600; color:var(--bleu-marine); margin-bottom:6px; }
    .channel-desc{ font-size:.85rem; line-height:1.4; }

    .action-area{
      margin-top:auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
    }
    .selection-hint{ font-size:.9rem; }
    .selection-count{ font-weight:600; color:var(--vert-fonce); }

    .btn-validate{
      background:var(--bleu-marine);
      color:var(--blanc);
    }
    .btn-validate:hover{ background:#1e2d5c; }
    .btn-validate:disabled{
      background:#cbd5e1;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    /* Feedback overlay */
    .feedback-overlay{
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,.5);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:100;
      opacity:0;
      transition:opacity .25s ease;
    }
    .feedback-overlay.show{ display:flex; opacity:1; }
    .feedback-card{
      background:var(--blanc);
      border-radius:20px;
      padding:40px;
      max-width:600px;
      width:min(600px, calc(100% - 40px));
      text-align:center;
      box-shadow:0 24px 48px rgba(0,0,0,.2);
    }
    .feedback-icon{
      width:72px; height:72px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      margin:0 auto 20px;
      font-size:36px;
    }
    .feedback-icon.success{ background:#dcfce7; color:var(--success); }
    .feedback-icon.partial{ background:#fef3c7; color:var(--warning); }
    .feedback-icon.error{ background:#fee2e2; color:var(--error); }
    .feedback-title{
      font-family:'Playfair Display', serif;
      font-size:1.5rem;
      color:var(--bleu-marine);
      margin-bottom:12px;
    }
    .feedback-text{ margin-bottom:18px; line-height:1.6; }
    .points-badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:linear-gradient(135deg, var(--vert-lime) 0%, #b5c120 100%);
      color:var(--bleu-marine);
      padding:8px 20px;
      border-radius:24px;
      font-weight:700;
      margin-bottom:18px;
    }
    .feedback-details{
      background:var(--gris-clair);
      border-radius:12px;
      padding:20px;
      text-align:left;
      margin-bottom:24px;
    }
    .feedback-details h4{
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:1px;
      color:var(--vert-fonce);
      margin-bottom:12px;
    }
    .feedback-details p{ font-size:.9rem; line-height:1.6; }

    /* Results */
    .results-screen{
      background:linear-gradient(135deg, var(--blanc) 0%, #f0f4e8 100%);
      justify-content:center;
      align-items:center;
      padding:40px;
    }
    .results-card{
      max-width:700px;
      background:var(--blanc);
      border-radius:24px;
      padding:48px;
      text-align:center;
      box-shadow:0 24px 48px rgba(0,0,0,.1);
    }
    .results-icon{
      width:100px; height:100px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      margin:0 auto 24px;
      font-size:48px;
    }
    .results-icon.excellent{ background:linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color:var(--success); }
    .results-icon.good{ background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color:var(--warning); }
    .results-icon.needs-work{ background:linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color:var(--error); }
    .results-title{
      font-family:'Playfair Display', serif;
      font-size:2rem;
      color:var(--bleu-marine);
      margin-bottom:16px;
    }
    .results-score{
      font-size:3.5rem;
      font-weight:800;
      background:linear-gradient(135deg, var(--vert-fonce) 0%, var(--bleu-marine) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:18px;
    }
    .results-message{ font-size:1.1rem; margin-bottom:24px; line-height:1.6; }
    .key-learnings{
      background:var(--gris-clair);
      border-radius:16px;
      padding:24px;
      text-align:left;
      margin-bottom:24px;
    }
    .key-learnings h3{
      color:var(--vert-fonce);
      font-size:1rem;
      margin-bottom:16px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .key-learnings ul{ list-style:none; }
    .key-learnings li{
      padding:8px 0 8px 24px;
      position:relative;
      font-size:.9rem;
      line-height:1.5;
    }
    .key-learnings li::before{
      content:'‚Üí';
      position:absolute;
      left:0;
      color:var(--vert-lime);
      font-weight:800;
    }

    .btn-restart{
      background:linear-gradient(135deg, var(--bleu-marine) 0%, #1e2d5c 100%);
      color:var(--blanc);
    }
    .btn-restart:hover{ transform:translateY(-2px); box-shadow:0 8px 24px rgba(39,60,134,.35); }

    /* accessibilit√© */
    .sr-only{
      position:absolute;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0);
      white-space:nowrap; border:0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo-area">
        <div class="logo-badge">ü•ê</div>
        <div class="header-title">Boulangeries Ange</div>
      </div>
      <div class="progress-area">
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="score-display">
          <span class="score-icon">‚òÖ</span>
          <span id="scoreDisplay">0 pts</span>
        </div>
      </div>
    </header>

    <main class="main-content">
      <!-- Intro -->
      <section class="screen intro-screen active" id="introScreen" aria-labelledby="introTitle">
        <div class="intro-card">
          <div class="intro-icon" aria-hidden="true">üìã</div>
          <h1 class="intro-title" id="introTitle">Choisir les bons canaux de recrutement</h1>
          <p class="intro-subtitle">
            En tant que responsable de boulangerie Ange, vous devez recruter diff√©rents profils.<br>
            S√©lectionnez les canaux adapt√©s selon le poste, l'urgence et le bassin d'emploi.
          </p>

          <div class="intro-context">
            <h3>üí° Ce que vous allez pratiquer</h3>
            <p>
              Vous serez confront√©(e) √† <strong>2 situations de recrutement</strong> concr√®tes.
              Pour chacune, analysez le contexte et choisissez les canaux les plus pertinents parmi ceux propos√©s.
              Plusieurs r√©ponses sont attendues pour chaque sc√©nario.
            </p>
          </div>

          <!-- IMPORTANT : plus de onclick -->
          <button class="btn btn-primary" id="startBtn" type="button">
            Commencer l'activit√© ‚Üí
          </button>
          <p class="sr-only" id="startHint">Appuyez sur Entr√©e ou Espace pour d√©marrer l'activit√©.</p>
        </div>
        <button class="btn btn-primary" id="startBtnAlt" type="button">
  D√©marrer directement ‚Üí
</button>
      </section>

      <!-- Sc√©narios -->
      <section class="screen scenario-screen" id="scenarioScreen" aria-live="polite">
        <div class="scenario-left">
          <div class="scenario-number" id="scenarioNumber">Sc√©nario 1/2</div>
          <h2 class="scenario-title" id="scenarioTitle">Titre du sc√©nario</h2>
          <div class="scenario-context" id="scenarioContext"></div>
        </div>

        <div class="scenario-right">
          <p class="question-prompt">Quels canaux de recrutement privil√©gieriez-vous dans cette situation ?</p>
          <div class="channels-grid" id="channelsGrid"></div>

          <div class="action-area">
            <span class="selection-hint">
              <span class="selection-count" id="selectionCount">0</span> canal(aux) s√©lectionn√©(s)
            </span>
            <button class="btn btn-validate" id="validateBtn" type="button" disabled>
              Valider ma r√©ponse
            </button>
          </div>
        </div>

        <div class="feedback-overlay" id="feedbackOverlay" role="dialog" aria-modal="true" aria-labelledby="feedbackTitle">
          <div class="feedback-card">
            <div class="feedback-icon" id="feedbackIcon">‚úì</div>
            <h3 class="feedback-title" id="feedbackTitle">Excellent !</h3>
            <div class="points-badge" id="pointsBadge">+ 0 points</div>
            <p class="feedback-text" id="feedbackText">Explication...</p>
            <div class="feedback-details">
              <h4>üìö √Ä retenir</h4>
              <p id="feedbackDetails">D√©tails...</p>
            </div>
            <button class="btn btn-primary" id="nextBtn" type="button">
              Continuer ‚Üí
            </button>
          </div>
        </div>
      </section>

      <!-- R√©sultats -->
      <section class="screen results-screen" id="resultsScreen">
        <div class="results-card">
          <div class="results-icon" id="resultsIcon">üèÜ</div>
          <h2 class="results-title">Activit√© termin√©e !</h2>
          <div class="results-score" id="finalScore">0/50</div>
          <p class="results-message" id="resultsMessage">Message de r√©sultat...</p>

          <div class="key-learnings">
            <h3>üí° Points cl√©s √† retenir</h3>
            <ul>
              <li><strong>Poste qualifi√©</strong> : mixez diffusion large + ciblage (sp√©cialis√© / proactif).</li>
              <li><strong>Urgence</strong> : activez des canaux rapides et locaux (int√©rim, vivier, affichage).</li>
              <li><strong>Bassin tendu</strong> : privil√©giez r√©seaux, cooptation et partenariats durables.</li>
              <li><strong>Strat√©gie multicanale</strong> : combinez 2‚Äì4 canaux selon le contexte.</li>
            </ul>
          </div>

          <button class="btn btn-restart" id="restartBtn" type="button">
            ‚Üª Recommencer l'activit√©
          </button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // === Configuration ===
    const DEBUG = false;
    const log = (...args) => DEBUG && console.log('[DEBUG]', ...args);

    // Donn√©es : 2 sc√©narios
    const scenarios = [
      {
        id: 1,
        title: "Recruter un boulanger exp√©riment√©",
        context: {
          poste: "Boulanger qualifi√© (CAP minimum, 3 ans d'exp√©rience)",
          urgence: "Mod√©r√©e ‚Äì D√©part pr√©vu dans 2 mois",
          bassin: "Zone urbaine avec forte concurrence (r√©gion parisienne)"
        },
        channels: [
          { id: "france_travail", name: "France Travail", desc: "Diffusion large, gratuit, profils vari√©s", icon: "üåê", correct: true },
          { id: "linkedin", name: "LinkedIn", desc: "R√©seau pro, sourcing de candidats passifs", icon: "üíº", correct: true },
          { id: "cooptation", name: "Cooptation", desc: "R√©seau interne et recommandations", icon: "ü§ù", correct: true },
          { id: "interim", name: "Int√©rim", desc: "Solution rapide et flexible", icon: "‚ö°", correct: false },
          { id: "ecoles", name: "√âcoles & CFA", desc: "Plut√¥t d√©butants / alternants", icon: "üéì", correct: false },
          { id: "metiers_bouche", name: "Sites m√©tiers de bouche", desc: "Ciblage sectoriel efficace", icon: "ü•ñ", correct: true }
        ],
        explanation:
          "Pour un profil qualifi√© en zone concurrentielle, combinez diffusion large + canaux cibl√©s. " +
          "LinkedIn et la cooptation aident √† toucher des candidats passifs. Les sites m√©tiers de bouche " +
          "renforcent le ciblage. L‚Äôint√©rim est moins adapt√© si vous visez un CDI, et les √©coles ciblent surtout des d√©butants.",
        points: 25
      },
      {
        id: 2,
        title: "Remplacement urgent d'un vendeur",
        context: {
          poste: "Vendeur/Vendeuse en boulangerie (d√©butant accept√©)",
          urgence: "Tr√®s urgent ‚Äì D√©part imm√©diat non anticip√©",
          bassin: "Zone semi-rurale, bassin d'emploi restreint"
        },
        channels: [
          { id: "france_travail", name: "France Travail", desc: "Diffusion large, gratuit, profils vari√©s", icon: "üåê", correct: true },
          { id: "linkedin", name: "LinkedIn", desc: "Souvent surdimensionn√© pour ce poste", icon: "üíº", correct: false },
          { id: "cooptation", name: "Cooptation", desc: "R√©seau local + √©quipe actuelle", icon: "ü§ù", correct: true },
          { id: "interim", name: "Int√©rim", desc: "Embauche tr√®s rapide", icon: "‚ö°", correct: true },
          { id: "vitrine", name: "Affichage en vitrine", desc: "Candidats de proximit√©", icon: "üìç", correct: true },
          { id: "cabinet", name: "Cabinet de recrutement", desc: "Co√ªt √©lev√©, d√©lai variable", icon: "üè¢", correct: false }
        ],
        explanation:
          "Sur un remplacement tr√®s urgent et local, vous gagnez du temps avec des canaux rapides et proches : " +
          "int√©rim, affichage en vitrine, cooptation. France Travail compl√®te pour diffuser largement. " +
          "LinkedIn et cabinet sont souvent disproportionn√©s pour un poste de vente d√©butant en urgence.",
        points: 25
      }
    ];

    // === State ===
    let currentScenario = 0;
    let score = 0;
    let selectedChannels = new Set();

    // === Helpers DOM ===
    const $ = (id) => document.getElementById(id);

    function showScreen(screenId) {
      const screens = ["introScreen", "scenarioScreen", "resultsScreen"];
      screens.forEach(id => $(id).classList.toggle("active", id === screenId));
    }

    function updateProgress() {
      const progress = ((currentScenario + 1) / scenarios.length) * 100;
      $("progressBar").style.width = `${progress}%`;
    }

    function updateScore() {
      $("scoreDisplay").textContent = `${score} pts`;
    }

    // === Activity logic ===
    function startActivity() {
      log('startActivity()');
      showScreen("scenarioScreen");
      loadScenario(0);
    }

    function loadScenario(index) {
      log('loadScenario', index);
      const scenario = scenarios[index];
      currentScenario = index;
      selectedChannels = new Set();

      $("scenarioNumber").textContent = `Sc√©nario ${index + 1}/${scenarios.length}`;
      $("scenarioTitle").textContent = scenario.title;

      $("scenarioContext").innerHTML = `
        <div class="context-item">
          <div class="context-icon">üë§</div>
          <div class="context-text">
            <div class="context-label">Poste √† pourvoir</div>
            <div class="context-value">${scenario.context.poste}</div>
          </div>
        </div>
        <div class="context-item">
          <div class="context-icon">‚è±Ô∏è</div>
          <div class="context-text">
            <div class="context-label">Niveau d'urgence</div>
            <div class="context-value">${scenario.context.urgence}</div>
          </div>
        </div>
        <div class="context-item">
          <div class="context-icon">üìç</div>
          <div class="context-text">
            <div class="context-label">Bassin d'emploi</div>
            <div class="context-value">${scenario.context.bassin}</div>
          </div>
        </div>
      `;

      const shuffled = [...scenario.channels].sort(() => Math.random() - 0.5);
      $("channelsGrid").innerHTML = shuffled.map(ch => `
        <div class="channel-card" data-id="${ch.id}" role="button" tabindex="0" aria-pressed="false">
          <div class="channel-icon">${ch.icon}</div>
          <div class="channel-name">${ch.name}</div>
          <div class="channel-desc">${ch.desc}</div>
        </div>
      `).join("");

      $("selectionCount").textContent = "0";
      $("validateBtn").disabled = true;
      updateProgress();

      // IMPORTANT : on attache les events via JS (pas inline)
      attachChannelEvents();
    }

    function attachChannelEvents() {
      const cards = document.querySelectorAll(".channel-card");
      cards.forEach(card => {
        const toggle = () => toggleChannel(card.dataset.id);

        card.addEventListener("click", toggle);

        // accessibilit√© clavier (Enter/Espace)
        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            toggle();
          }
        });
      });
    }

    function toggleChannel(channelId) {
      const card = document.querySelector(`.channel-card[data-id="${channelId}"]`);
      if (!card) return;

      if (selectedChannels.has(channelId)) {
        selectedChannels.delete(channelId);
        card.classList.remove("selected");
        card.setAttribute("aria-pressed", "false");
      } else {
        selectedChannels.add(channelId);
        card.classList.add("selected");
        card.setAttribute("aria-pressed", "true");
      }

      $("selectionCount").textContent = String(selectedChannels.size);
      $("validateBtn").disabled = selectedChannels.size === 0;
    }

    function validateAnswer() {
      const scenario = scenarios[currentScenario];
      const correctIds = scenario.channels.filter(c => c.correct).map(c => c.id);

      let correctSelections = 0;
      let incorrectSelections = 0;
      let missedSelections = 0;

      document.querySelectorAll(".channel-card").forEach(card => {
        const id = card.dataset.id;
        const isCorrect = correctIds.includes(id);
        const isSelected = selectedChannels.has(id);

        card.style.pointerEvents = "none";

        if (isSelected && isCorrect) {
          card.classList.add("correct");
          correctSelections++;
        } else if (isSelected && !isCorrect) {
          card.classList.add("incorrect");
          incorrectSelections++;
        } else if (!isSelected && isCorrect) {
          card.classList.add("missed");
          missedSelections++;
        }
      });

      const maxPoints = scenario.points;
      const totalCorrect = correctIds.length;

      // scoring simple : proportion de bons choix - p√©nalit√© erreurs
      const pointsEarned = Math.max(
        0,
        Math.round((correctSelections / totalCorrect) * maxPoints - (incorrectSelections * 3))
      );

      score += pointsEarned;
      updateScore();

      showFeedback(correctSelections, incorrectSelections, missedSelections, pointsEarned, scenario.explanation);
    }

    function showFeedback(correct, incorrect, missed, points, explanation) {
      const overlay = $("feedbackOverlay");
      const icon = $("feedbackIcon");
      const title = $("feedbackTitle");
      const pointsBadge = $("pointsBadge");
      const text = $("feedbackText");
      const details = $("feedbackDetails");

      if (incorrect === 0 && missed === 0) {
        icon.className = "feedback-icon success";
        icon.textContent = "‚úì";
        title.textContent = "Excellent !";
        text.textContent = "Vous avez identifi√© tous les canaux pertinents sans erreur.";
      } else if (correct > incorrect && missed <= 1) {
        icon.className = "feedback-icon partial";
        icon.textContent = "‚óê";
        title.textContent = "Bien jou√© !";
        text.textContent =
          `Vous avez trouv√© la plupart des bons canaux. ` +
          (missed > 0 ? `Il en manquait ${missed}. ` : "") +
          (incorrect > 0 ? `${incorrect} choix √©taient moins pertinents.` : "");
      } else {
        icon.className = "feedback-icon error";
        icon.textContent = "‚úó";
        title.textContent = "√Ä am√©liorer";
        text.textContent = "Revoyez les crit√®res : poste, urgence et bassin d‚Äôemploi.";
      }

      pointsBadge.textContent = `+ ${points} points`;
      details.textContent = explanation;

      overlay.classList.add("show");
    }

    function nextScenario() {
      $("feedbackOverlay").classList.remove("show");

      if (currentScenario < scenarios.length - 1) {
        loadScenario(currentScenario + 1);
      } else {
        showResults();
      }
    }

    function showResults() {
      showScreen("resultsScreen");

      const maxScore = scenarios.reduce((sum, s) => sum + s.points, 0);
      const percentage = Math.round((score / maxScore) * 100);

      $("finalScore").textContent = `${score}/${maxScore}`;

      const icon = $("resultsIcon");
      const msg = $("resultsMessage");

      if (percentage >= 80) {
        icon.className = "results-icon excellent";
        icon.textContent = "üèÜ";
        msg.textContent = "F√©licitations ! Vous ma√Ætrisez tr√®s bien la s√©lection des canaux selon le contexte.";
      }

      else if (percentage >= 50) {
        icon.className = "results-icon good";
        icon.textContent = "üëç";
        msg.textContent = "Bon travail ! Vous avez une bonne compr√©hension des canaux. Quelques ajustements vous rendront encore plus efficace.";
      } else {
        icon.className = "results-icon needs-work";
        icon.textContent = "üìö";
        msg.textContent = "Continuez √† vous entra√Æner : le bon canal d√©pend du poste, de l'urgence et du bassin d‚Äôemploi.";
      }

      updateProgress();
    }

    function restartActivity() {
      score = 0;
      currentScenario = 0;
      selectedChannels = new Set();
      updateScore();
      showScreen("introScreen");
      $("progressBar").style.width = "0%";

      // r√©active l'overlay au cas o√π
      $("feedbackOverlay").classList.remove("show");
    }

    // === Bind events (le point cl√© pour GitHub Pages) ===
    // On attend que le DOM soit pr√™t, puis on branche les actions
    document.addEventListener("DOMContentLoaded", () => {
      log("DOM ready");

      // D√©marrer
      $("startBtn").addEventListener("click", startActivity);

      // Valider
      $("validateBtn").addEventListener("click", validateAnswer);

      // Continuer (overlay)
      $("nextBtn").addEventListener("click", nextScenario);

      // Recommencer
      $("restartBtn").addEventListener("click", restartActivity);

      // Optionnel : fermer l'overlay au clic sur le fond (pas obligatoire)
      $("feedbackOverlay").addEventListener("click", (e) => {
        if (e.target === $("feedbackOverlay")) {
          $("feedbackOverlay").classList.remove("show");
        }
      });

      // Initialisation affichage
      updateScore();
      $("progressBar").style.width = "0%";
    });
  </script>
</body>
</html>
