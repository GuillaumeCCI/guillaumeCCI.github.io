<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Choisir les bons canaux de recrutement ‚Äî Boulangeries Ange</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root{
      --vert-lime:#c8d223;
      --vert-fonce:#195850;
      --bleu-marine:#273c86;
      --blanc:#ffffff;
      --gris-clair:#f8f9fa;
      --gris-texte:#4a4a4a;
      --success:#22c55e;
      --warning:#f59e0b;
      --error:#ef4444;
      --border:#e5e7eb;
      --shadow: rgba(0,0,0,0.08);
    }

    html, body{
      width:100%;
      height:100%;
      font-family:'DM Sans', sans-serif;
      background:var(--blanc);
      color:var(--gris-texte);
    }

    .container{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
    }

    /* Header */
    .header{
      background:var(--blanc);
      padding:16px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:3px solid var(--vert-lime);
      flex-shrink:0;
    }
    .logo-area{ display:flex; align-items:center; gap:16px; }
    .logo-badge{
      width:48px; height:48px;
      background:linear-gradient(135deg,var(--vert-lime) 0%, #a8b31e 100%);
      border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-size:24px;
      box-shadow:0 4px 12px rgba(200,210,35,0.3);
      user-select:none;
    }
    .header-title{
      font-family:'Playfair Display', serif;
      font-size:1.4rem;
      color:var(--bleu-marine);
      font-weight:600;
    }
    .progress-area{ display:flex; align-items:center; gap:24px; }
    .progress-bar-container{
      width:200px; height:8px;
      background:var(--gris-clair);
      border-radius:4px;
      overflow:hidden;
    }
    .progress-bar{
      height:100%;
      background:linear-gradient(90deg,var(--vert-fonce), var(--vert-lime));
      width:0%;
      transition: width .4s ease;
    }
    .score-display{
      background:var(--gris-clair);
      padding:8px 20px;
      border-radius:24px;
      font-weight:500;
      color:var(--bleu-marine);
      display:flex; align-items:center; gap:8px;
      user-select:none;
    }
    .score-icon{ color:var(--vert-lime); }

    /* Main */
    .main-content{
      flex:1;
      display:flex;
      overflow:hidden;
      position:relative;
      background:linear-gradient(135deg, var(--blanc) 0%, #f0f4e8 100%);
    }

    /* Screens */
    .screen{
      position:absolute;
      inset:0;
      display:none;
      opacity:0;
      transition: opacity .25s ease;
    }
    .screen.active{
      display:flex;
      opacity:1;
    }

    /* Intro */
    .intro-screen{
      justify-content:center;
      align-items:center;
      padding:40px;
    }
    .intro-card{
      max-width:800px;
      text-align:center;
      padding:10px;
    }
    .intro-icon{
      width:100px; height:100px;
      background:linear-gradient(135deg,var(--vert-fonce) 0%, var(--bleu-marine) 100%);
      border-radius:24px;
      margin:0 auto 28px;
      display:flex; align-items:center; justify-content:center;
      font-size:48px;
      box-shadow:0 16px 40px rgba(25,88,80,0.2);
      user-select:none;
    }
    .intro-title{
      font-family:'Playfair Display', serif;
      font-size:2.2rem;
      color:var(--bleu-marine);
      margin-bottom:10px;
    }
    .intro-subtitle{
      font-size:1.05rem;
      line-height:1.7;
      margin-bottom:28px;
    }
    .intro-context{
      background:var(--blanc);
      border-left:4px solid var(--vert-lime);
      padding:22px;
      text-align:left;
      border-radius:0 12px 12px 0;
      box-shadow:0 4px 20px rgba(0,0,0,0.05);
      margin-bottom:28px;
    }
    .intro-context h3{
      color:var(--vert-fonce);
      margin-bottom:10px;
      font-size:.95rem;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .intro-context p{ font-size:.95rem; line-height:1.6; }

    /* Buttons */
    .btn{
      padding:16px 40px;
      border:none;
      border-radius:10px;
      font-family:'DM Sans', sans-serif;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      user-select:none;
    }
    .btn:focus-visible{
      outline: 3px solid rgba(39,60,134,0.35);
      outline-offset: 3px;
    }
    .btn-primary{
      background:linear-gradient(135deg,var(--vert-fonce) 0%, #1e6b61 100%);
      color:var(--blanc);
      box-shadow:0 6px 18px rgba(25,88,80,0.28);
    }
    .btn-primary:hover{ transform: translateY(-1px); box-shadow:0 10px 24px rgba(25,88,80,0.36); }
    .btn-secondary{
      background:var(--bleu-marine);
      color:var(--blanc);
      box-shadow:0 6px 18px rgba(39,60,134,0.25);
    }
    .btn-secondary:hover{ transform: translateY(-1px); box-shadow:0 10px 24px rgba(39,60,134,0.35); }
    .btn:disabled{
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
      background:#cbd5e1 !important;
      color:#ffffff;
    }

    /* Scenario layout */
    .scenario-screen{
      display:flex;
      flex-direction:row;
      width:100%;
      height:100%;
      background:transparent;
    }
    .scenario-left{
      width:40%;
      background:linear-gradient(180deg, var(--bleu-marine) 0%, #1e2d5c 100%);
      padding:40px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      color:var(--blanc);
      position:relative;
      overflow:hidden;
    }
    .scenario-left::before{
      content:'';
      position:absolute;
      top:-50%;
      right:-50%;
      width:100%;
      height:100%;
      background:radial-gradient(circle, rgba(200,210,35,0.12) 0%, transparent 70%);
      pointer-events:none;
    }
    .scenario-number{
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:2px;
      color:var(--vert-lime);
      margin-bottom:16px;
    }
    .scenario-title{
      font-family:'Playfair Display', serif;
      font-size:1.8rem;
      margin-bottom:18px;
      line-height:1.25;
    }
    .scenario-context{
      background:rgba(255,255,255,0.12);
      padding:20px;
      border-radius:14px;
    }
    .context-item{
      display:flex;
      gap:12px;
      margin-bottom:14px;
      align-items:flex-start;
    }
    .context-item:last-child{ margin-bottom:0; }
    .context-icon{
      width:36px; height:36px;
      border-radius:10px;
      background:rgba(200,210,35,0.18);
      display:flex; align-items:center; justify-content:center;
      flex-shrink:0;
      user-select:none;
    }
    .context-label{
      font-size:.75rem;
      text-transform:uppercase;
      letter-spacing:1px;
      color:rgba(255,255,255,0.75);
      margin-bottom:4px;
    }
    .context-value{
      font-size:.95rem;
      font-weight:600;
      line-height:1.35;
    }

    .scenario-right{
      flex:1;
      padding:40px;
      display:flex;
      flex-direction:column;
      overflow:auto;
    }
    .question-prompt{
      font-size:1.1rem;
      color:var(--bleu-marine);
      margin-bottom:18px;
      font-weight:700;
    }
    .channels-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:16px;
      margin-bottom:20px;
    }
    .channel-card{
      background:var(--blanc);
      border:2px solid var(--border);
      border-radius:14px;
      padding:18px;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      position:relative;
      min-height:110px;
    }
    .channel-card:hover{
      border-color:var(--vert-fonce);
      transform:translateY(-1px);
      box-shadow:0 10px 24px var(--shadow);
    }
    .channel-card.selected{
      border-color:var(--vert-fonce);
      background:linear-gradient(135deg,#f0f9f7 0%, #f8fdf8 100%);
    }
    .channel-card.selected::after{
      content:'‚úì';
      position:absolute;
      top:12px; right:12px;
      width:24px; height:24px;
      border-radius:999px;
      background:var(--vert-fonce);
      color:var(--blanc);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      font-size:14px;
    }
    .channel-card.correct{
      border-color:var(--success);
      background:#f0fdf4;
    }
    .channel-card.incorrect{
      border-color:var(--error);
      background:#fef2f2;
    }
    .channel-card.missed{
      border-color:var(--warning);
      background:#fffbeb;
    }
    .channel-icon{
      width:44px; height:44px;
      border-radius:12px;
      background:var(--gris-clair);
      display:flex; align-items:center; justify-content:center;
      font-size:20px;
      margin-bottom:10px;
      user-select:none;
    }
    .channel-name{
      font-weight:800;
      color:var(--bleu-marine);
      margin-bottom:6px;
    }
    .channel-desc{
      font-size:.88rem;
      line-height:1.35;
      color:var(--gris-texte);
    }
    .action-area{
      margin-top:auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:18px;
      padding-top:8px;
    }
    .selection-hint{
      font-size:.95rem;
      color:var(--gris-texte);
    }
    .selection-count{
      font-weight:900;
      color:var(--vert-fonce);
    }

    /* Overlay feedback */
    .feedback-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1000;
      padding:22px;
    }
    .feedback-overlay.show{ display:flex; }
    .feedback-card{
      width:min(640px, 100%);
      background:var(--blanc);
      border-radius:22px;
      padding:34px;
      box-shadow:0 24px 60px rgba(0,0,0,0.25);
      text-align:center;
    }
    .feedback-icon{
      width:72px; height:72px;
      margin:0 auto 14px;
      border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      font-size:34px;
      user-select:none;
    }
    .feedback-title{
      font-family:'Playfair Display', serif;
      font-size:1.5rem;
      color:var(--bleu-marine);
      margin-bottom:8px;
    }
    .points-badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 18px;
      border-radius:999px;
      background:linear-gradient(135deg, var(--vert-lime) 0%, #b5c120 100%);
      color:var(--bleu-marine);
      font-weight:900;
      margin:10px 0 14px;
      user-select:none;
    }
    .feedback-text{ line-height:1.6; margin-bottom:14px; }
    .feedback-details{
      text-align:left;
      background:var(--gris-clair);
      border-radius:14px;
      padding:18px;
      margin-bottom:18px;
    }
    .feedback-details h4{
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:1px;
      color:var(--vert-fonce);
      margin-bottom:8px;
    }
    .feedback-details p{ line-height:1.6; font-size:.95rem; }

    /* Results */
    .results-screen{
      justify-content:center;
      align-items:center;
      padding:40px;
    }
    .results-card{
      width:min(760px, 100%);
      background:var(--blanc);
      border-radius:24px;
      padding:48px;
      text-align:center;
      box-shadow:0 24px 48px rgba(0,0,0,0.1);
    }
    .results-icon{
      width:100px; height:100px;
      border-radius:999px;
      margin:0 auto 18px;
      display:flex; align-items:center; justify-content:center;
      font-size:46px;
      user-select:none;
    }
    .results-title{
      font-family:'Playfair Display', serif;
      font-size:2rem;
      color:var(--bleu-marine);
      margin-bottom:10px;
    }
    .results-score{
      font-size:3rem;
      font-weight:900;
      background:linear-gradient(135deg, var(--vert-fonce) 0%, var(--bleu-marine) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:14px;
    }
    .results-message{ font-size:1.05rem; line-height:1.6; margin-bottom:20px; }
    .key-learnings{
      background:var(--gris-clair);
      border-radius:16px;
      padding:22px;
      text-align:left;
      margin-bottom:22px;
    }
    .key-learnings h3{
      color:var(--vert-fonce);
      margin-bottom:12px;
      font-size:1rem;
    }
    .key-learnings ul{ padding-left:18px; }
    .key-learnings li{ margin:8px 0; line-height:1.5; }

    @media (max-width: 980px){
      .scenario-screen{ flex-direction:column; }
      .scenario-left{ width:100%; padding:28px; }
      .scenario-right{ padding:28px; }
      .channels-grid{ grid-template-columns: 1fr; }
      .header{ padding:14px 18px; }
      .progress-bar-container{ width:140px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo-area">
        <div class="logo-badge">ü•ê</div>
        <div class="header-title">Boulangeries Ange</div>
      </div>
      <div class="progress-area">
        <div class="progress-bar-container" aria-label="Progression">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="score-display" aria-label="Score">
          <span class="score-icon">‚òÖ</span>
          <span id="scoreDisplay">0 pts</span>
        </div>
      </div>
    </header>

    <main class="main-content">

      <!-- INTRO -->
      <section class="screen intro-screen active" id="introScreen" aria-label="√âcran d‚Äôintroduction">
        <div class="intro-card">
          <div class="intro-icon">üìã</div>
          <h1 class="intro-title">Choisir les bons canaux de recrutement</h1>
          <p class="intro-subtitle">
            En tant que responsable de boulangerie Ange, vous recrutez diff√©rents profils.<br>
            S√©lectionnez les canaux adapt√©s selon le poste, l‚Äôurgence et le bassin d‚Äôemploi.
          </p>

          <div class="intro-context">
            <h3>üí° Ce que vous allez pratiquer</h3>
            <p>
              Vous serez confront√©(e) √† <strong>2 situations de recrutement</strong>. Pour chacune, analysez le contexte
              et choisissez les canaux les plus pertinents parmi ceux propos√©s. <strong>Plusieurs r√©ponses</strong> sont attendues.
            </p>
          </div>

          <button class="btn btn-primary" id="startBtn" type="button">
            Commencer l‚Äôactivit√© ‚Üí
          </button>
        </div>
      </section>

      <!-- SCENARIO -->
      <section class="screen scenario-screen" id="scenarioScreen" aria-label="√âcran sc√©nario">
        <div class="scenario-left">
          <div class="scenario-number" id="scenarioNumber">Sc√©nario 1/2</div>
          <h2 class="scenario-title" id="scenarioTitle">Titre</h2>

          <div class="scenario-context" id="scenarioContext"></div>
        </div>

        <div class="scenario-right">
          <p class="question-prompt">Quels canaux de recrutement privil√©gieriez-vous dans cette situation ?</p>

          <div class="channels-grid" id="channelsGrid" aria-label="Choix des canaux"></div>

          <div class="action-area">
            <span class="selection-hint">
              <span class="selection-count" id="selectionCount">0</span> canal(aux) s√©lectionn√©(s)
            </span>

            <button class="btn btn-secondary" id="validateBtn" type="button" disabled>
              Valider ma r√©ponse
            </button>
          </div>
        </div>

        <!-- FEEDBACK OVERLAY -->
        <div class="feedback-overlay" id="feedbackOverlay" aria-modal="true" role="dialog" aria-label="Feedback">
          <div class="feedback-card">
            <div class="feedback-icon" id="feedbackIcon">‚úì</div>
            <h3 class="feedback-title" id="feedbackTitle">Excellent !</h3>

            <div class="points-badge" id="pointsBadge">+ 0 points</div>

            <p class="feedback-text" id="feedbackText">‚Ä¶</p>

            <div class="feedback-details">
              <h4>üìö √Ä retenir</h4>
              <p id="feedbackDetails">‚Ä¶</p>
            </div>

            <button class="btn btn-primary" id="nextBtn" type="button">
              Continuer ‚Üí
            </button>
          </div>
        </div>
      </section>

      <!-- RESULTS -->
      <section class="screen results-screen" id="resultsScreen" aria-label="R√©sultats">
        <div class="results-card">
          <div class="results-icon" id="resultsIcon">üèÜ</div>
          <h2 class="results-title">Activit√© termin√©e !</h2>

          <div class="results-score" id="finalScore">0/50</div>
          <p class="results-message" id="resultsMessage">‚Ä¶</p>

          <div class="key-learnings">
            <h3>üí° Points cl√©s √† retenir</h3>
            <ul>
              <li><strong>Urgence forte</strong> : privil√©gier des canaux rapides (int√©rim, vivier local, affichage).</li>
              <li><strong>Profils qualifi√©s</strong> : ajouter des canaux pro et cibl√©s (LinkedIn, sites m√©tiers, cooptation).</li>
              <li><strong>Bassin restreint</strong> : activer la proximit√© (vitrine, r√©seau, cooptation).</li>
              <li><strong>Approche multicanale</strong> : combiner ‚Äúlarge diffusion‚Äù + ‚Äúciblage‚Äù selon le contexte.</li>
            </ul>
          </div>

          <button class="btn btn-secondary" id="restartBtn" type="button">
            ‚Üª Recommencer
          </button>
        </div>
      </section>

    </main>
  </div>

  <script>
    // ----------------------------
    // Data (2 sc√©narios)
    // ----------------------------
    const scenarios = [
      {
        id: 1,
        title: "Recruter un boulanger exp√©riment√©",
        context: {
          poste: "Boulanger qualifi√© (CAP minimum, 3 ans d‚Äôexp√©rience)",
          urgence: "Mod√©r√©e ‚Äî d√©part pr√©vu dans 2 mois",
          bassin: "Zone urbaine tr√®s concurrentielle (r√©gion parisienne)"
        },
        channels: [
          { id: "francetravail", name: "France Travail", desc: "Diffusion large, gratuit, profils vari√©s", icon: "üåê", correct: true },
          { id: "linkedin",      name: "LinkedIn",      desc: "R√©seau pro, sourcing de candidats passifs", icon: "üíº", correct: true },
          { id: "cooptation",    name: "Cooptation",    desc: "Recommandations et r√©seau interne", icon: "ü§ù", correct: true },
          { id: "interim",       name: "Int√©rim",       desc: "Rapide mais plut√¥t temporaire", icon: "‚ö°", correct: false },
          { id: "ecoles",        name: "√âcoles / CFA",  desc: "Cible plut√¥t alternants / d√©butants", icon: "üéì", correct: false },
          { id: "metiers",       name: "Sites m√©tiers de bouche", desc: "Candidats cibl√©s du secteur", icon: "ü•ñ", correct: true }
        ],
        explanation:
          "Pour un profil exp√©riment√© en zone concurrentielle, l‚Äôefficacit√© vient du mix : visibilit√© (France Travail) + ciblage (sites m√©tiers) + acc√®s aux candidats passifs (LinkedIn) + acc√©l√©ration via r√©seau (cooptation). L‚Äôint√©rim r√©pond √† une logique court terme, et les √©coles ciblent davantage des profils d√©butants.",
        points: 25
      },
      {
        id: 2,
        title: "Remplacement urgent d‚Äôun vendeur",
        context: {
          poste: "Vendeur / Vendeuse (d√©butant accept√©)",
          urgence: "Tr√®s urgent ‚Äî d√©part imm√©diat",
          bassin: "Zone semi-rurale, bassin d‚Äôemploi restreint"
        },
        channels: [
          { id: "francetravail", name: "France Travail", desc: "Large diffusion, r√©activit√© possible", icon: "üåê", correct: true },
          { id: "interim",       name: "Int√©rim",       desc: "Solution rapide et flexible", icon: "‚ö°", correct: true },
          { id: "cooptation",    name: "Cooptation",    desc: "R√©seau local et recommandations", icon: "ü§ù", correct: true },
          { id: "vitrine",       name: "Affichage vitrine", desc: "Proximit√©, candidats locaux", icon: "üìç", correct: true },
          { id: "linkedin",      name: "LinkedIn",      desc: "Souvent surdimensionn√© pour ce poste", icon: "üíº", correct: false },
          { id: "cabinet",       name: "Cabinet de recrutement", desc: "Co√ªteux / long pour un besoin urgent simple", icon: "üè¢", correct: false }
        ],
        explanation:
          "Sur un besoin urgent et un profil peu sp√©cialis√©, on priorise la vitesse et la proximit√© : int√©rim pour combler imm√©diatement, affichage vitrine et cooptation pour activer le r√©seau local, France Travail pour √©largir rapidement. LinkedIn et un cabinet sont g√©n√©ralement disproportionn√©s ici.",
        points: 25
      }
    ];

    // ----------------------------
    // State
    // ----------------------------
    let currentIndex = 0;
    let score = 0;
    let selected = new Set();
    let locked = false; // emp√™che clics pendant correction

    // ----------------------------
    // Elements
    // ----------------------------
    const introScreen    = document.getElementById('introScreen');
    const scenarioScreen = document.getElementById('scenarioScreen');
    const resultsScreen  = document.getElementById('resultsScreen');

    const startBtn    = document.getElementById('startBtn');
    const validateBtn = document.getElementById('validateBtn');
    const nextBtn     = document.getElementById('nextBtn');
    const restartBtn  = document.getElementById('restartBtn');

    const progressBar  = document.getElementById('progressBar');
    const scoreDisplay = document.getElementById('scoreDisplay');

    const scenarioNumber  = document.getElementById('scenarioNumber');
    const scenarioTitle   = document.getElementById('scenarioTitle');
    const scenarioContext = document.getElementById('scenarioContext');
    const channelsGrid    = document.getElementById('channelsGrid');
    const selectionCount  = document.getElementById('selectionCount');

    const feedbackOverlay = document.getElementById('feedbackOverlay');
    const feedbackIcon    = document.getElementById('feedbackIcon');
    const feedbackTitle   = document.getElementById('feedbackTitle');
    const pointsBadge     = document.getElementById('pointsBadge');
    const feedbackText    = document.getElementById('feedbackText');
    const feedbackDetails = document.getElementById('feedbackDetails');

    const resultsIcon    = document.getElementById('resultsIcon');
    const finalScore     = document.getElementById('finalScore');
    const resultsMessage = document.getElementById('resultsMessage');

    // ----------------------------
    // Helpers
    // ----------------------------
    function showScreen(screenEl){
      [introScreen, scenarioScreen, resultsScreen].forEach(el => el.classList.remove('active'));
      screenEl.classList.add('active');
    }

    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function updateProgress(){
      const progress = ((currentIndex) / scenarios.length) * 100;
      progressBar.style.width = `${progress}%`;
    }

    function updateScore(){
      scoreDisplay.textContent = `${score} pts`;
    }

    function setSelectionCount(){
      selectionCount.textContent = String(selected.size);
      validateBtn.disabled = (selected.size === 0) || locked;
    }

    // ----------------------------
    // Render
    // ----------------------------
    function renderScenario(index){
      const s = scenarios[index];
      currentIndex = index;
      selected = new Set();
      locked = false;

      scenarioNumber.textContent = `Sc√©nario ${index + 1}/${scenarios.length}`;
      scenarioTitle.textContent = s.title;

      scenarioContext.innerHTML = `
        <div class="context-item">
          <div class="context-icon">üë§</div>
          <div>
            <div class="context-label">Poste √† pourvoir</div>
            <div class="context-value">${escapeHtml(s.context.poste)}</div>
          </div>
        </div>
        <div class="context-item">
          <div class="context-icon">‚è±Ô∏è</div>
          <div>
            <div class="context-label">Niveau d‚Äôurgence</div>
            <div class="context-value">${escapeHtml(s.context.urgence)}</div>
          </div>
        </div>
        <div class="context-item">
          <div class="context-icon">üìç</div>
          <div>
            <div class="context-label">Bassin d‚Äôemploi</div>
            <div class="context-value">${escapeHtml(s.context.bassin)}</div>
          </div>
        </div>
      `;

      const channels = shuffle(s.channels);

      channelsGrid.innerHTML = channels.map(ch => `
        <div class="channel-card" role="button" tabindex="0" data-id="${ch.id}" aria-pressed="false">
          <div class="channel-icon">${ch.icon}</div>
          <div class="channel-name">${escapeHtml(ch.name)}</div>
          <div class="channel-desc">${escapeHtml(ch.desc)}</div>
        </div>
      `).join('');

      setSelectionCount();
      updateProgress();
    }

    // s√©curit√© XSS minimale (pas indispensable ici mais propre)
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ----------------------------
    // Interaction (sans onclick inline)
    // ----------------------------
    function startActivity(){
      showScreen(scenarioScreen);
      renderScenario(0);
    }

    function toggleChannel(cardEl){
      if (locked) return;

      const id = cardEl.dataset.id;
      if (!id) return;

      if (selected.has(id)) {
        selected.delete(id);
        cardEl.classList.remove('selected');
        cardEl.setAttribute('aria-pressed', 'false');
      } else {
        selected.add(id);
        cardEl.classList.add('selected');
        cardEl.setAttribute('aria-pressed', 'true');
      }
      setSelectionCount();
    }

    function validateAnswer(){
      if (locked) return;
      locked = true;
      validateBtn.disabled = true;

      const s = scenarios[currentIndex];
      const correctIds = new Set(s.channels.filter(c => c.correct).map(c => c.id));

      let correctSelections = 0;
      let incorrectSelections = 0;
      let missedSelections = 0;

      // marque les cartes
      const cards = [...channelsGrid.querySelectorAll('.channel-card')];
      for (const card of cards){
        const id = card.dataset.id;
        const isCorrect = correctIds.has(id);
        const isSelected = selected.has(id);

        card.style.pointerEvents = 'none';

        if (isSelected && isCorrect){
          card.classList.add('correct');
          correctSelections++;
        } else if (isSelected && !isCorrect){
          card.classList.add('incorrect');
          incorrectSelections++;
        } else if (!isSelected && isCorrect){
          card.classList.add('missed');
          missedSelections++;
        }
      }

      // score
      const maxPoints = s.points;
      const totalCorrect = correctIds.size;

      const raw = Math.round((correctSelections / totalCorrect) * maxPoints - (incorrectSelections * 3));
      const pointsEarned = Math.max(0, raw);

      score += pointsEarned;
      updateScore();

      showFeedback({ correctSelections, incorrectSelections, missedSelections, pointsEarned, explanation: s.explanation });
    }

    function showFeedback({ correctSelections, incorrectSelections, missedSelections, pointsEarned, explanation }){
      // ic√¥ne + message
      if (incorrectSelections === 0 && missedSelections === 0){
        feedbackIcon.style.background = '#dcfce7';
        feedbackIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--success');
        feedbackIcon.textContent = '‚úì';
        feedbackTitle.textContent = 'Excellent !';
        feedbackText.textContent = 'Vous avez identifi√© tous les canaux pertinents sans erreur.';
      } else if (correctSelections > incorrectSelections && missedSelections <= 1){
        feedbackIcon.style.background = '#fef3c7';
        feedbackIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--warning');
        feedbackIcon.textContent = '‚óê';
        feedbackTitle.textContent = 'Bien jou√© !';
        feedbackText.textContent = `Vous avez trouv√© la plupart des bons canaux. ${missedSelections ? `Il en manquait ${missedSelections}.` : ''} ${incorrectSelections ? `${incorrectSelections} choix √©taient moins pertinents.` : ''}`.trim();
      } else {
        feedbackIcon.style.background = '#fee2e2';
        feedbackIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error');
        feedbackIcon.textContent = '‚úó';
        feedbackTitle.textContent = '√Ä am√©liorer';
        feedbackText.textContent = 'Revoyez les crit√®res : nature du poste, urgence et bassin d‚Äôemploi.';
      }

      pointsBadge.textContent = `+ ${pointsEarned} points`;
      feedbackDetails.textContent = explanation;

      feedbackOverlay.classList.add('show');

      // am√©liore l‚Äôaccessibilit√© : focus sur le bouton ‚ÄúContinuer‚Äù
      nextBtn.focus();
    }

    function closeFeedback(){
      feedbackOverlay.classList.remove('show');
    }

    function nextScenario(){
      closeFeedback();

      // reset pointer events
      const cards = [...channelsGrid.querySelectorAll('.channel-card')];
      for (const c of cards){
        c.style.pointerEvents = '';
        c.classList.remove('correct','incorrect','missed','selected');
        c.setAttribute('aria-pressed','false');
      }

      if (currentIndex < scenarios.length - 1){
        renderScenario(currentIndex + 1);
      } else {
        showResults();
      }
    }

    function showResults(){
      showScreen(resultsScreen);

      const maxScore = scenarios.reduce((sum, s) => sum + s.points, 0);
      finalScore.textContent = `${score}/${maxScore}`;

      const percentage = Math.round((score / maxScore) * 100);

      if (percentage >= 80){
        resultsIcon.textContent = 'üèÜ';
        resultsIcon.style.background = '#dcfce7';
        resultsIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--success');
        resultsMessage.textContent = "Tr√®s solide : vous choisissez des canaux coh√©rents avec les contraintes. Vous √™tes pr√™t(e) √† arbitrer vite et bien.";
      } else if (percentage >= 50){
        resultsIcon.textContent = 'üëç';
        resultsIcon.style.background = '#fef3c7';
        resultsIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--warning');
        resultsMessage.textContent = "Bon niveau : il reste quelques ajustements sur le bon dosage entre rapidit√©, ciblage et proximit√©.";
      } else {
        resultsIcon.textContent = 'üìö';
        resultsIcon.style.background = '#fee2e2';
        resultsIcon.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error');
        resultsMessage.textContent = "On y est presque : reprenez la logique ¬´ urgence / bassin / qualification ¬ª et activez un vrai mix de canaux.";
      }

      // progression √† 100% une fois fini
      progressBar.style.width = '100%';
    }

    function restart(){
      score = 0;
      updateScore();
      currentIndex = 0;
      selected = new Set();
      locked = false;

      progressBar.style.width = '0%';
      showScreen(introScreen);
      startBtn.focus();
    }

    // ----------------------------
    // Event binding (IMPORTANT)
    // ----------------------------
    document.addEventListener('DOMContentLoaded', () => {
      // Boutons
      startBtn.addEventListener('click', startActivity);
      validateBtn.addEventListener('click', validateAnswer);
      nextBtn.addEventListener('click', nextScenario);
      restartBtn.addEventListener('click', restart);

      // Click sur cartes (d√©l√©gation : robuste m√™me si on re-render)
      channelsGrid.addEventListener('click', (e) => {
        const card = e.target.closest('.channel-card');
        if (!card) return;
        toggleChannel(card);
      });

      // Clavier : Enter/Espace sur cartes
      channelsGrid.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter' && e.key !== ' ') return;
        const card = e.target.closest('.channel-card');
        if (!card) return;
        e.preventDefault();
        toggleChannel(card);
      });

      // Fermer overlay au clic hors carte (optionnel)
      feedbackOverlay.addEventListener('click', (e) => {
        if (e.target === feedbackOverlay) {
          // On ne ferme pas automatiquement : on oblige √† "Continuer"
          // mais vous pouvez d√©commenter si vous le souhaitez.
          // closeFeedback();
        }
      });

      // √âchap pour fermer overlay (optionnel, ici on ne ferme pas)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && feedbackOverlay.classList.contains('show')) {
          // closeFeedback();
        }
      });

      updateProgress();
      updateScore();
    });
  </script>
</body>
</html>
