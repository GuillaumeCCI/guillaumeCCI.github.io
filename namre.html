import React, { useState } from "react";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PHASES = [
  { id: "intro", label: "Accueil" },
  { id: "tri", label: "Tri express" },
  { id: "construction", label: "Construire l'annonce" },
  { id: "bilan", label: "Bilan" },
];

const BAKERY_CONTEXT = {
  nom: "Le Fournil des Halles",
  desc: "Boulangerie artisanale de 10 salariÃ©s, implantÃ©e depuis 12 ans en centre-ville de Rennes. Farines bio livrÃ©es par 2 minoteries bretonnes (rayon < 40 km), levain naturel, cuisson au four Ã  sole. LabellisÃ©e Â« Artisan de confiance Â» depuis 2022. 3 boutiques, 1 fournil central. Collecte des invendus via Too Good To Go depuis 2021.",
  poste: "Boulanger / BoulangÃ¨re en CDI",
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE 1 â€” TRI EXPRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TRI_ITEMS = [
  { id: 1, text: "Jeune boulanger dynamique recherchÃ©", bad: true, cat: "Ã‚ge", fix: "Boulanger(Ã¨re) enthousiaste et motivÃ©(e)" },
  { id: 2, text: "MaÃ®trise parfaite du franÃ§ais oral et Ã©crit", bad: false },
  { id: 3, text: "Merci de joindre une photo rÃ©cente", bad: true, cat: "Apparence", fix: "Merci de joindre CV + lettre de motivation" },
  { id: 4, text: "Poste avec manutention rÃ©guliÃ¨re de charges (25 kg)", bad: false },
  { id: 5, text: "Homme de terrain, robuste et endurant", bad: true, cat: "Genre", fix: "Personne de terrain, Ã  l'aise dans un environnement physique" },
  { id: 6, text: "ExpÃ©rience de 3 ans en boulangerie artisanale souhaitÃ©e", bad: false },
  { id: 7, text: "DisponibilitÃ© totale, pas de contraintes familiales", bad: true, cat: "Famille", fix: "Poste en horaires dÃ©calÃ©s (4h-12h), du mardi au samedi" },
  { id: 8, text: "RÃ©munÃ©ration : 24 000â€“28 000 â‚¬ brut/an selon expÃ©rience", bad: false },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE 2 â€” CONSTRUCTION (Textes Ã©quilibrÃ©s en longueur)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STEPS = [
  { id: "entete", label: "En-tÃªte", icon: "ğŸ“Œ", num: "01" },
  { id: "presentation", label: "Qui sommes-nous", icon: "ğŸ ", num: "02" },
  { id: "missions", label: "Missions", icon: "ğŸ¯", num: "03" },
  { id: "profil", label: "Profil recherchÃ©", icon: "ğŸ‘¤", num: "04" },
  { id: "conditions", label: "Conditions & RSE", icon: "ğŸ“‹", num: "05" },
];

const ENTETE_FIELDS = [
  {
    id: "intitule", label: "IntitulÃ© du poste",
    options: [
      { id: "a", text: "Boulanger qualifiÃ© pour rejoindre notre Ã©quipe de production matinale", correct: false, why: "Masculin seul, excluant. Ne cible pas la bonne requÃªte." },
      { id: "b", text: "Boulanger / BoulangÃ¨re (H/F) en CDI â€” Rejoignez notre fournil", correct: true, why: "IntitulÃ© inclusif, clair, conforme Ã  la loi et orientÃ© recherche." },
      { id: "c", text: "Artisan pÃ©trisseur polyvalent passionnÃ© par le travail de la pÃ¢te", correct: false, why: "Trop original : le candidat ne trouvera pas l'offre en cherchant Â« boulanger Â»." },
    ],
  },
  {
    id: "contrat", label: "Type de contrat",
    options: [
      { id: "a", text: "Contrat Ã  DurÃ©e IndÃ©terminÃ©e (CDI) â€“ Temps plein (35h/semaine)", correct: true, why: "Clair, prÃ©cis, et juridiquement conforme aux attentes d'un candidat." },
      { id: "b", text: "CDD de 6 mois avec une forte possibilitÃ© d'Ã©volution vers un CDI Ã  l'issue", correct: false, why: "Promettre un CDI Ã  l'issue d'un CDD est juridiquement risquÃ© si non garanti." },
      { id: "c", text: "CDI avec une pÃ©riode d'essai de 2 mois stricte et potentiellement Ã©liminatoire", correct: false, why: "Le terme Â« Ã©liminatoire Â» est menaÃ§ant et inadaptÃ© pour attirer des talents." },
    ],
  },
  {
    id: "experience", label: "ExpÃ©rience demandÃ©e",
    options: [
      { id: "a", text: "Maximum 5 ans d'expÃ©rience souhaitÃ©e afin de s'adapter Ã  nos mÃ©thodes", correct: false, why: "Un plafond d'expÃ©rience est une discrimination indirecte par l'Ã¢ge." },
      { id: "b", text: "2 Ã  4 ans d'expÃ©rience rÃ©ussie en boulangerie artisanale exigÃ©e", correct: true, why: "Fourchette raisonnable, contextualisÃ©e, sans plafond excluant les plus Ã¢gÃ©s." },
      { id: "c", text: "Profil expert senior justifiant d'un minimum de 15 annÃ©es d'expÃ©rience", correct: false, why: "DurÃ©e excessive combinÃ©e au mot Â« senior Â» = discrimination par l'Ã¢ge." },
    ],
  },
  {
    id: "localisation", label: "Localisation",
    options: [
      { id: "a", text: "Rennes centre (35) â€” Laboratoire de production du Fournil des Halles", correct: true, why: "PrÃ©cis : ville, dÃ©partement, lieu de travail exact. Utile pour le trajet." },
      { id: "b", text: "Bretagne (dÃ©placements ponctuels possibles entre nos diffÃ©rents sites)", correct: false, why: "Trop vague : le candidat ne peut pas Ã©valuer son temps de trajet quotidien." },
    ],
  },
];

const PRESENTATION_BLOCKS = [
  { id: "p1", text: "Boulangerie artisanale de 10 salariÃ©s, comprenant 3 boutiques situÃ©es Ã  Rennes et un laboratoire de production central.", good: true, order: 1, why: "Factuel : taille, implantation, structure. Le candidat comprend concrÃ¨tement l'entreprise." },
  { id: "p2", text: "Notre passion du pain est notre ADN depuis toujours, nous mettons tout notre cÅ“ur et notre amour authentique dans nos fabrications quotidiennes.", good: false, why: "Phrase creuse et jargonneuse. Ne donne aucune information concrÃ¨te au candidat." },
  { id: "p3", text: "Farines 100% bio livrÃ©es par 2 minoteries bretonnes (rayon < 40 km), utilisation exclusive de levain naturel, et cuisson au four Ã  sole.", good: true, order: 2, why: "Engagements RSE concrets, chiffrÃ©s et vÃ©rifiables. Le candidat voit la rÃ©alitÃ© du travail." },
  { id: "p4", text: "Entreprise fortement engagÃ©e, Ã©co-responsable et soucieuse de l'environnement, travaillant dans une dÃ©marche globale de dÃ©veloppement durable.", good: false, why: "Affirmation sans aucune preuve = greenwashing. La RSE se prouve par des faits." },
  { id: "p5", text: "LabellisÃ©e Â« Artisan de confiance Â» depuis 2022 et partenaire du dispositif de collecte des invendus Too Good To Go depuis l'annÃ©e 2021.", good: true, order: 3, why: "Preuves concrÃ¨tes : label + dispositif anti-gaspi datÃ©. C'est crÃ©dible et vÃ©rifiable." },
  { id: "p6", text: "Nous sommes une grande famille bienveillante, dynamique et chaleureuse qui adore ce qu'elle fait ! Rejoignez une Ã©quipe toujours souriante.", good: false, why: "Ton infantilisant et subjectif, inadaptÃ© pour une annonce professionnelle sÃ©rieuse." },
];

const MISSIONS_BUILD = [
  {
    id: "m1", slot: "Mission 1 â€” Production quotidienne",
    versions: [
      { id: "a", text: "Fabriquer quotidiennement les pains traditionnels et spÃ©ciaux (environ 12 rÃ©fÃ©rences) dans le strict respect des recettes maison", correct: true },
      { id: "b", text: "Assurer la production de l'ensemble de la gamme de pains, en respectant les consignes donnÃ©es et en maintenant un rythme soutenu", correct: false, why: "Trop flou et met la pression. Combien de rÃ©fÃ©rences ? Quel type de fabrication ?" },
    ],
  },
  {
    id: "m2", slot: "Mission 2 â€” Technique de fermentation",
    versions: [
      { id: "a", text: "GÃ©rer la production dans une logique agile, optimiser les flux de fabrication et suivre les KPIs de qualitÃ© de la boulangerie", correct: false, why: "Jargon managÃ©rial/startup incomprÃ©hensible pour le cÅ“ur de mÃ©tier d'un boulanger." },
      { id: "b", text: "Conduire les fermentations au levain naturel : rÃ©aliser le pointage, le faÃ§onnage, l'apprÃªt, tout en respectant les temps de pousse", correct: true },
    ],
  },
  {
    id: "m3", slot: "Mission 3 â€” Cuisson",
    versions: [
      { id: "a", text: "Cuire au four Ã  sole : maÃ®trise prÃ©cise des tempÃ©ratures, de la buÃ©e et des temps de cuisson selon les spÃ©cificitÃ©s des produits", correct: true },
      { id: "b", text: "Piloter la cuisson transversale des produits en coordination avec les Ã©quipes de vente pour garantir un rÃ©assort continu des vitrines", correct: false, why: "Â« Transversale Â» est du jargon inutile. La mission doit Ãªtre technique, pas marketing." },
    ],
  },
  {
    id: "m4", slot: "Mission 4 â€” HygiÃ¨ne et qualitÃ©",
    versions: [
      { id: "a", text: "Effectuer diverses tÃ¢ches de nettoyage, d'entretien et d'hygiÃ¨ne de l'espace de travail, selon les plannings affichÃ©s dans le laboratoire", correct: false, why: "Â« Diverses tÃ¢ches Â» est une expression fourre-tout qui masque la rÃ©alitÃ© de la mission." },
      { id: "b", text: "Appliquer et faire respecter les normes HACCP : nettoyage rigoureux du fournil, traÃ§abilitÃ© des matiÃ¨res, contrÃ´le des tempÃ©ratures", correct: true },
    ],
  },
  {
    id: "m5", slot: "Mission 5 â€” Transmission",
    versions: [
      { id: "a", text: "Accompagner nos apprentis dans l'acquisition des gestes techniques de base de la boulangerie (Ã©tapes de pÃ©trissage et de faÃ§onnage)", correct: true },
      { id: "b", text: "Manager les profils juniors de l'Ã©quipe, assurer leur montÃ©e en compÃ©tences globale et rÃ©aliser les entretiens individuels d'Ã©valuation", correct: false, why: "Ceci correspond Ã  une fiche de poste de manager/chef, pas de boulanger classique." },
    ],
  },
];

const PROFIL_ITEMS = [
  { id: "c1", text: "DiplÃ´me de niveau CAP Boulanger minimum", category: "indispensable" },
  { id: "c2", text: "Excellente maÃ®trise du four Ã  sole et du levain naturel", category: "indispensable" },
  { id: "c3", text: "Candidat(e) de langue maternelle franÃ§aise (natif)", category: "interdit", fix: "MaÃ®trise du franÃ§ais oral et Ã©crit" },
  { id: "c4", text: "Connaissance pointue des normes d'hygiÃ¨ne HACCP", category: "indispensable" },
  { id: "c5", text: "ExpÃ©rience prÃ©alable en pÃ¢tisserie boulangÃ¨re (viennoiseries)", category: "apprecie" },
  { id: "c6", text: "Excellente prÃ©sentation et apparence soignÃ©e exigÃ©es", category: "interdit", fix: "Sens du contact client et savoir-Ãªtre" },
  { id: "c7", text: "SensibilitÃ© affirmÃ©e aux circuits courts et aux produits bio", category: "apprecie" },
  { id: "c8", text: "Grande rigueur, ponctualitÃ© infaillible et fort esprit d'Ã©quipe", category: "indispensable" },
  { id: "c9", text: "Profil jeune, dynamique, sportif et trÃ¨s rÃ©sistant au stress", category: "interdit", fix: "PersonnalitÃ© enthousiaste, proactive et endurante" },
  { id: "c10", text: "MaÃ®trise d'un outil ERP de gestion des stocks (type Notilia)", category: "apprecie" },
];

const CONDITIONS_FIELDS = [
  {
    id: "salaire", label: "RÃ©munÃ©ration",
    options: [
      { id: "a", text: "RÃ©munÃ©ration trÃ¨s attractive et Ã©volutive, Ã  dÃ©finir prÃ©cisÃ©ment selon votre profil, vos compÃ©tences et votre implication", correct: false, why: "Le fameux Â« selon profil Â» fait fuir les candidats. Il faut donner une fourchette claire." },
      { id: "b", text: "Entre 24 000 et 28 000 â‚¬ brut annuel selon expÃ©rience prÃ©alable + prime mensuelle de panification sur objectifs", correct: true, why: "Fourchette claire, avantage spÃ©cifique inclus. Transparence totale dÃ¨s la lecture." },
    ],
  },
  {
    id: "horaires", label: "Horaires et contraintes",
    options: [
      { id: "a", text: "DisponibilitÃ© totale et flexibilitÃ© requises, travail trÃ¨s rÃ©gulier les week-ends, et prÃ©sence indispensable lors des jours fÃ©riÃ©s", correct: false, why: "Â« DisponibilitÃ© totale Â» est source de stress, vague et potentiellement discriminant (famille)." },
      { id: "b", text: "Horaires fixes : 4h00 â€“ 12h00, du mardi au samedi. Les jours fÃ©riÃ©s sont travaillÃ©s selon un roulement dÃ©fini (environ 6/an)", correct: true, why: "Horaires extrÃªmement prÃ©cis et chiffrÃ©s. Le candidat peut projeter son organisation de vie." },
    ],
  },
  {
    id: "avantages", label: "Avantages",
    options: [
      { id: "a", text: "Mutuelle prise en charge Ã  60%, pain offert chaque jour, forfait mobilitÃ© durable (vÃ©lo), formation continue aux techniques bio", correct: true, why: "Des avantages concrets, quantifiables et surtout cohÃ©rents avec l'image RSE de la boulangerie." },
      { id: "b", text: "Excellente ambiance de travail garantie, Ã©quipe jeune et trÃ¨s sympa, cadre de travail agrÃ©able en plein centre-ville", correct: false, why: "Ce ne sont pas de vrais avantages contractuels mais des affirmations subjectives invÃ©rifiables." },
    ],
  },
  {
    id: "processus", label: "Processus de recrutement",
    options: [
      { id: "a", text: "Envoyez-nous rapidement votre CV dÃ©taillÃ© par email. Nous Ã©tudierons votre candidature et vous recontacterons si profil adÃ©quat", correct: false, why: "Opaque. Le candidat ne connaÃ®t ni les Ã©tapes, ni les dÃ©lais, ni le mode d'Ã©valuation." },
      { id: "b", text: "CV + LM Ã  recrutement@fournil-halles.fr. Processus : prÃ©sÃ©lection (3j) â†’ entretien (45 min) â†’ essai au fournil (1 mat.) â†’ rÃ©ponse (10j)", correct: true, why: "La transparence parfaite : contacts, durÃ©e de chaque Ã©tape et dÃ©lai de rÃ©ponse garanti." },
    ],
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STYLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const C = {
  bg: "#f8f9fb", white: "#ffffff", text: "#1e293b", textLight: "#64748b", textMuted: "#94a3b8",
  accent: "#4338ca", accentLight: "#e0e7ff", accentSoft: "#eef2ff",
  warm: "#b45309", warmBg: "#fffbeb",
  ok: "#059669", okBg: "#ecfdf5", okBorder: "#a7f3d0",
  err: "#dc2626", errBg: "#fef2f2", errBorder: "#fecaca",
  border: "#e2e8f0", borderLight: "#f1f5f9",
  shadow: "0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04)",
};

const btnP = {
  padding: "11px 32px", background: C.accent, color: "#fff", border: "none",
  borderRadius: 10, fontSize: 14, fontWeight: 600, cursor: "pointer",
  fontFamily: "'Plus Jakarta Sans',sans-serif", boxShadow: "0 2px 8px rgba(67,56,202,0.25)",
  transition: "all 0.2s"
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Card({ children, style, onClick }) {
  return (
    <div onClick={onClick} style={{
      background: C.white, border: `1.5px solid ${C.border}`, borderRadius: 14,
      padding: "16px 20px", cursor: onClick ? "pointer" : "default", transition: "all 0.2s",
      boxShadow: C.shadow, ...style
    }}>
      {children}
    </div>
  );
}

function Badge({ children, color = C.accent }) {
  return (
    <span style={{
      display: "inline-block", padding: "4px 12px", borderRadius: 999,
      fontSize: 12, fontWeight: 600, background: `${color}15`, color, border: `1px solid ${color}30`
    }}>
      {children}
    </span>
  );
}

function StepDots({ steps, current }) {
  return (
    <div style={{ display: "flex", alignItems: "center", gap: 4, marginBottom: 24, flexWrap: "wrap" }}>
      {steps.map((s, i) => (
        <div key={s.id} style={{ display: "flex", alignItems: "center", gap: 4 }}>
          <div style={{
            width: 28, height: 28, borderRadius: "50%", display: "flex", alignItems: "center",
            justifyContent: "center", fontSize: 12, fontWeight: 700,
            background: i < current ? C.ok : i === current ? C.accent : C.borderLight,
            color: i <= current ? "#fff" : C.textMuted, transition: "all 0.3s"
          }}>
            {i < current ? "âœ“" : i + 1}
          </div>
          {i === current && <span style={{ fontSize: 12, fontWeight: 600, color: C.text }}>{s.label}</span>}
          {i < steps.length - 1 && <div style={{ width: 16, height: 2, background: i < current ? C.ok : C.border, borderRadius: 2 }} />}
        </div>
      ))}
    </div>
  );
}

// OptionPicker repensÃ© : on ne montre plus la correction immÃ©diatement !
function OptionPicker({ options, selected, onSelect }) {
  return (
    <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
      {options.map((opt) => {
        const isSel = selected === opt.id;
        let brd = isSel ? C.accent : C.border;
        let bg = isSel ? C.accentSoft : C.white;

        return (
          <div key={opt.id} onClick={() => onSelect(opt.id)} style={{
            padding: "12px 16px", borderRadius: 10, cursor: "pointer",
            transition: "all 0.2s", border: `2px solid ${brd}`, background: bg
          }}>
            <div style={{ display: "flex", alignItems: "flex-start", gap: 10 }}>
              <div style={{
                width: 20, height: 20, borderRadius: "50%", flexShrink: 0, marginTop: 1,
                border: isSel ? "none" : `2px solid ${C.border}`,
                background: isSel ? C.accent : "transparent",
                display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 11, fontWeight: 700
              }}>
                {isSel ? "â—" : ""}
              </div>
              <span style={{ fontSize: 14, color: C.text, lineHeight: 1.6 }}>{opt.text}</span>
            </div>
          </div>
        );
      })}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTRO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function IntroPhase({ onNext }) {
  return (
    <div style={{ textAlign: "center", maxWidth: 640, margin: "0 auto" }}>
      <div style={{ width: 80, height: 80, borderRadius: 20, margin: "0 auto 20px", background: C.warmBg, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 40, boxShadow: C.shadow }}>ğŸ¥–</div>
      <h1 style={{ fontFamily: "'Fraunces',serif", fontSize: 32, fontWeight: 700, color: C.text, marginBottom: 10, lineHeight: 1.2 }}>RÃ©diger une annonce d'emploi</h1>
      <p style={{ color: C.textLight, fontSize: 14, marginBottom: 6 }}>CompÃ©tence visÃ©e : <strong style={{ color: C.text }}>rÃ©diger une annonce claire, non discriminante et attractive</strong></p>
      <p style={{ color: C.textMuted, fontSize: 14, lineHeight: 1.7, marginBottom: 32, maxWidth: 520, margin: "0 auto 32px" }}>
        Vous Ãªtes responsable RH de la boulangerie <strong style={{ color: C.text }}>Le Fournil des Halles</strong> Ã  Rennes. Vous devez recruter un(e) boulanger(Ã¨re) en CDI.
      </p>

      <div style={{ display: "flex", gap: 12, marginBottom: 32, textAlign: "left" }}>
        {[
          { icon: "ğŸ”", title: "Tri express", desc: "Classez 8 formulations : acceptables ou discriminantes" },
          { icon: "ğŸ—ï¸", title: "Construction", desc: "Assemblez l'annonce complÃ¨te en 5 Ã©tapes" },
          { icon: "ğŸ“‹", title: "Bilan dÃ©taillÃ©", desc: "Visualisez votre score et la correction dÃ©taillÃ©e Ã  la fin" },
        ].map((item) => (
          <Card key={item.title} style={{ flex: 1, padding: "14px 16px" }}>
            <div style={{ fontSize: 22, marginBottom: 6 }}>{item.icon}</div>
            <div style={{ fontSize: 14, fontWeight: 600, color: C.text, marginBottom: 4 }}>{item.title}</div>
            <div style={{ fontSize: 12, color: C.textMuted, lineHeight: 1.5 }}>{item.desc}</div>
          </Card>
        ))}
      </div>

      <Card style={{ textAlign: "left", background: C.warmBg, border: "1px solid #fde68a", marginBottom: 32 }}>
        <div style={{ fontSize: 13, color: C.warm, fontWeight: 700, marginBottom: 6 }}>ğŸ“Œ Contexte â€” {BAKERY_CONTEXT.nom}</div>
        <p style={{ fontSize: 13, color: "#78350f", lineHeight: 1.7, margin: 0 }}>{BAKERY_CONTEXT.desc}</p>
      </Card>

      <button onClick={onNext} style={{ ...btnP, padding: "14px 48px", fontSize: 16 }}>Commencer l'exercice â†’</button>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRI EXPRESS (ImmÃ©diat)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function TriPhase({ onNext, score, setScore }) {
  const [cur, setCur] = useState(0);
  const [ans, setAns] = useState(null);

  const item = TRI_ITEMS[cur];
  const done = ans !== null;
  const ok = ans === item.bad;

  const pick = (v) => {
    if (done) return;
    setAns(v);
    if (v === item.bad) setScore((s) => s + 1);
  };

  const next = () => {
    if (cur < TRI_ITEMS.length - 1) {
      setCur((c) => c + 1);
      setAns(null);
    } else {
      onNext();
    }
  };

  return (
    <div style={{ maxWidth: 640, margin: "0 auto" }}>
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 }}>
        <div>
          <h2 style={{ fontFamily: "'Fraunces',serif", color: C.text, fontSize: 22, margin: 0 }}>Tri express</h2>
          <p style={{ color: C.textMuted, fontSize: 13, margin: "4px 0 0" }}>Cette formulation peut-elle figurer dans une annonce ?</p>
        </div>
        <Badge>{cur + 1} / {TRI_ITEMS.length}</Badge>
      </div>

      <Card style={{ marginBottom: 20, background: C.accentSoft, border: `1px solid ${C.accentLight}` }}>
        <div style={{ fontSize: 17, color: C.text, lineHeight: 1.7, fontWeight: 500, padding: "8px 0", textAlign: "center" }}>
          Â« {item.text} Â»
        </div>
      </Card>

      <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 8 }}>
        {[
          { val: false, label: "âœ… Acceptable", sub: "Peut figurer dans l'annonce", goodC: C.ok },
          { val: true, label: "âš ï¸ Discriminante", sub: "Ã€ reformuler", goodC: C.err },
        ].map((opt) => {
          const isSel = ans === opt.val;
          const isRight = done && opt.val === item.bad;
          const isWrong = done && isSel && !ok;
          let brd = C.border, bg = C.white;

          if (isRight) { brd = opt.goodC; bg = opt.val ? C.errBg : C.okBg; }
          if (isWrong) { brd = C.err; bg = C.errBg; }

          return (
            <div key={String(opt.val)} onClick={() => pick(opt.val)} style={{
              padding: "18px 16px", borderRadius: 12, textAlign: "center", cursor: done ? "default" : "pointer",
              transition: "all 0.2s", opacity: done && !isRight && !isWrong ? 0.4 : 1, border: `2px solid ${brd}`,
              background: bg, boxShadow: C.shadow
            }}>
              <div style={{ fontSize: 16, fontWeight: 600, color: C.text, marginBottom: 4 }}>{opt.label}</div>
              <div style={{ fontSize: 12, color: C.textMuted }}>{opt.sub}</div>
            </div>
          );
        })}
      </div>

      {done && (
        <div style={{ animation: "fadeSlideIn 0.3s" }}>
          <div style={{ marginTop: 10, padding: "10px 14px", borderRadius: 10, fontSize: 13, lineHeight: 1.6, background: ok ? C.okBg : C.errBg, border: `1px solid ${ok ? C.okBorder : C.errBorder}`, color: ok ? "#065f46" : "#991b1b" }}>
            <span style={{ fontWeight: 700, marginRight: 6 }}>{ok ? "âœ“" : "âœ—"}</span>
            {item.bad ? <>CatÃ©gorie : <strong>{item.cat}</strong>. Reformulation : Â« {item.fix} Â»</> : "Cette formulation est factuelle et lÃ©gale."}
          </div>
          <div style={{ textAlign: "right", marginTop: 16 }}>
            <button onClick={next} style={btnP}>{cur < TRI_ITEMS.length - 1 ? "Suivant â†’" : "Construire l'annonce â†’"}</button>
          </div>
        </div>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTRUCTION WRAPPER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ConstructionPhase({ onNext, cAns, setCAns }) {
  const [step, setStep] = useState(0);

  const nextStep = () => {
    if (step < STEPS.length - 1) setStep(s => s + 1);
    else onNext();
  };

  return (
    <div style={{ maxWidth: 720, margin: "0 auto" }}>
      <div style={{ marginBottom: 8 }}>
        <h2 style={{ fontFamily: "'Fraunces',serif", color: C.text, fontSize: 22, margin: "0 0 4px" }}>ğŸ—ï¸ Construisez votre annonce</h2>
        <p style={{ color: C.textMuted, fontSize: 13, margin: "0 0 16px" }}>SÃ©lectionnez les meilleures propositions. La correction s'affichera Ã  la fin.</p>
      </div>
      <StepDots steps={STEPS} current={step} />

      <div style={{ display: step === 0 ? "block" : "none" }}>
        <EnteteStep cAns={cAns} setCAns={setCAns} onNext={nextStep} />
      </div>
      <div style={{ display: step === 1 ? "block" : "none" }}>
        <PresentationStep cAns={cAns} setCAns={setCAns} onNext={nextStep} />
      </div>
      <div style={{ display: step === 2 ? "block" : "none" }}>
        <MissionsStep cAns={cAns} setCAns={setCAns} onNext={nextStep} />
      </div>
      <div style={{ display: step === 3 ? "block" : "none" }}>
        <ProfilStep cAns={cAns} setCAns={setCAns} onNext={nextStep} />
      </div>
      <div style={{ display: step === 4 ? "block" : "none" }}>
        <ConditionsStep cAns={cAns} setCAns={setCAns} onNext={nextStep} />
      </div>
    </div>
  );
}

// â”€â”€â”€ En-tÃªte â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EnteteStep({ cAns, setCAns, onNext }) {
  const ans = cAns.entete;
  const setAns = (id, val) => setCAns(p => ({ ...p, entete: { ...p.entete, [id]: val } }));
  const allDone = ENTETE_FIELDS.every(f => ans[f.id]);

  return (
    <div className="fadeSlide">
      <Card style={{ marginBottom: 20, background: C.warmBg, border: "1px solid #fde68a" }}>
        <div style={{ fontSize: 13, fontWeight: 600, color: C.warm, marginBottom: 4 }}>ğŸ“Œ En-tÃªte â€” Mentions obligatoires</div>
        <p style={{ fontSize: 13, color: "#78350f", margin: 0, lineHeight: 1.6 }}>ComplÃ©tez chaque champ en choisissant la formulation correcte.</p>
      </Card>
      {ENTETE_FIELDS.map(f => (
        <div key={f.id} style={{ marginBottom: 20 }}>
          <div style={{ fontSize: 14, fontWeight: 600, color: C.text, marginBottom: 8 }}>{f.label}</div>
          <OptionPicker options={f.options} selected={ans[f.id]} onSelect={(val) => setAns(f.id, val)} />
        </div>
      ))}
      <div style={{ textAlign: "right" }}>
        <button onClick={onNext} disabled={!allDone} style={{ ...btnP, opacity: allDone ? 1 : 0.4 }}>Ã‰tape suivante â†’</button>
      </div>
    </div>
  );
}

// â”€â”€â”€ PrÃ©sentation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PresentationStep({ cAns, setCAns, onNext }) {
  const sel = cAns.pres;
  const toggle = (id) => setCAns(p => ({ ...p, pres: p.pres.includes(id) ? p.pres.filter(x => x !== id) : [...p.pres, id] }));

  return (
    <div className="fadeSlide">
      <Card style={{ marginBottom: 20, background: C.warmBg, border: "1px solid #fde68a" }}>
        <div style={{ fontSize: 13, fontWeight: 600, color: C.warm, marginBottom: 4 }}>ğŸ“Œ Qui sommes-nous ?</div>
        <p style={{ fontSize: 13, color: "#78350f", margin: 0, lineHeight: 1.6 }}>SÃ©lectionnez uniquement les Ã©lÃ©ments factuels et crÃ©dibles. Rejetez le greenwashing.</p>
      </Card>
      <div style={{ display: "flex", flexDirection: "column", gap: 10, marginBottom: 20 }}>
        {PRESENTATION_BLOCKS.map(b => {
          const isSel = sel.includes(b.id);
          return (
            <div key={b.id} onClick={() => toggle(b.id)} style={{
              padding: "14px 18px", borderRadius: 12, cursor: "pointer", transition: "all 0.2s",
              border: `2px solid ${isSel ? C.accent : C.border}`, background: isSel ? C.accentSoft : C.white
            }}>
              <div style={{ display: "flex", alignItems: "flex-start", gap: 12 }}>
                <div style={{
                  width: 22, height: 22, borderRadius: 6, flexShrink: 0, marginTop: 1, border: isSel ? "none" : `2px solid ${C.border}`,
                  background: isSel ? C.accent : "transparent", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 12, fontWeight: 700
                }}>{isSel ? "âœ“" : ""}</div>
                <span style={{ fontSize: 14, color: C.text, lineHeight: 1.6 }}>{b.text}</span>
              </div>
            </div>
          );
        })}
      </div>
      <div style={{ textAlign: "right" }}>
        <button onClick={onNext} disabled={sel.length === 0} style={{ ...btnP, opacity: sel.length ? 1 : 0.4 }}>Ã‰tape suivante â†’</button>
      </div>
    </div>
  );
}

// â”€â”€â”€ Missions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MissionsStep({ cAns, setCAns, onNext }) {
  const ans = cAns.missions;
  const setAns = (id, val) => setCAns(p => ({ ...p, missions: { ...p.missions, [id]: val } }));
  const allDone = MISSIONS_BUILD.every(m => ans[m.id]);

  return (
    <div className="fadeSlide">
      <Card style={{ marginBottom: 20, background: C.warmBg, border: "1px solid #fde68a" }}>
        <div style={{ fontSize: 13, fontWeight: 600, color: C.warm, marginBottom: 4 }}>ğŸ“Œ Vos missions</div>
        <p style={{ fontSize: 13, color: "#78350f", margin: 0, lineHeight: 1.6 }}>Pour chaque mission, choisissez la formulation la plus concrÃ¨te et objective.</p>
      </Card>
      {MISSIONS_BUILD.map(m => (
        <div key={m.id} style={{ marginBottom: 20 }}>
          <div style={{ fontSize: 13, fontWeight: 600, color: C.accent, marginBottom: 8 }}>{m.slot}</div>
          <OptionPicker options={m.versions} selected={ans[m.id]} onSelect={(val) => setAns(m.id, val)} />
        </div>
      ))}
      <div style={{ textAlign: "right" }}>
        <button onClick={onNext} disabled={!allDone} style={{ ...btnP, opacity: allDone ? 1 : 0.4 }}>Ã‰tape suivante â†’</button>
      </div>
    </div>
  );
}

// â”€â”€â”€ Profil (Nouvelle UI de "peinture") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ProfilStep({ cAns, setCAns, onNext }) {
  const pl = cAns.profil;
  const setPl = (id, cat) => setCAns(p => ({ ...p, profil: { ...p.profil, [id]: cat } }));
  const [activeTool, setActiveTool] = useState(null);

  const cats = [
    { id: "indispensable", label: "Indispensable", color: C.accent, bg: C.accentSoft },
    { id: "apprecie", label: "ApprÃ©ciÃ©", color: C.warm, bg: C.warmBg },
    { id: "interdit", label: "Ã€ supprimer", color: C.err, bg: C.errBg },
  ];

  const allPlaced = PROFIL_ITEMS.every(i => pl[i.id]);

  return (
    <div className="fadeSlide">
      <Card style={{ marginBottom: 20, background: C.warmBg, border: "1px solid #fde68a" }}>
        <div style={{ fontSize: 13, fontWeight: 600, color: C.warm, marginBottom: 4 }}>ğŸ“Œ Profil recherchÃ©</div>
        <p style={{ fontSize: 13, color: "#78350f", margin: 0, lineHeight: 1.6 }}>
          1. Cliquez sur l'une des 3 bulles ci-dessous pour la sÃ©lectionner.<br />
          2. Cliquez ensuite sur les critÃ¨res pour leur appliquer ce choix.
        </p>
      </Card>

      {/* Toolbar */}
      <div style={{ display: "flex", gap: 10, marginBottom: 20, flexWrap: "wrap", justifyContent: "center", padding: "10px", background: "#fff", borderRadius: 12, border: `1px solid ${C.border}` }}>
        {cats.map(c => {
          const isActive = activeTool === c.id;
          return (
            <button key={c.id} onClick={() => setActiveTool(isActive ? null : c.id)} style={{
              padding: "8px 16px", borderRadius: 999, fontSize: 13, fontWeight: 600, border: `2px solid ${isActive ? c.color : "transparent"}`,
              background: isActive ? c.color : c.bg, color: isActive ? "#fff" : c.color, cursor: "pointer", transition: "all 0.2s", transform: isActive ? "scale(1.05)" : "scale(1)"
            }}>
              {c.label} {isActive && "ğŸ–Œï¸"}
            </button>
          );
        })}
      </div>

      <div style={{ display: "flex", flexDirection: "column", gap: 8, marginBottom: 20 }}>
        {PROFIL_ITEMS.map(item => {
          const cat = cats.find(c => c.id === pl[item.id]);
          return (
            <div key={item.id} onClick={() => activeTool && setPl(item.id, activeTool)} style={{
              padding: "12px 16px", borderRadius: 10, cursor: activeTool ? "pointer" : "default", transition: "all 0.2s",
              border: `2px solid ${cat ? `${cat.color}60` : C.border}`, background: cat ? `${cat.color}08` : C.white,
              display: "flex", alignItems: "center", justifyContent: "space-between"
            }}>
              <span style={{ fontSize: 14, color: C.text }}>{item.text}</span>
              <span style={{
                padding: "4px 12px", borderRadius: 999, fontSize: 11, fontWeight: 700,
                background: cat ? `${cat.color}15` : C.borderLight, color: cat ? cat.color : C.textMuted,
                border: `1px solid ${cat ? `${cat.color}30` : C.border}`, minWidth: 90, textAlign: "center"
              }}>
                {cat ? cat.label : "Ã€ classer"}
              </span>
            </div>
          );
        })}
      </div>
      <div style={{ textAlign: "right" }}>
        <button onClick={onNext} disabled={!allPlaced} style={{ ...btnP, opacity: allPlaced ? 1 : 0.4 }}>Ã‰tape suivante â†’</button>
      </div>
    </div>
  );
}

// â”€â”€â”€ Conditions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ConditionsStep({ cAns, setCAns, onNext }) {
  const ans = cAns.conditions;
  const setAns = (id, val) => setCAns(p => ({ ...p, conditions: { ...p.conditions, [id]: val } }));
  const allDone = CONDITIONS_FIELDS.every(f => ans[f.id]);

  return (
    <div className="fadeSlide">
      <Card style={{ marginBottom: 20, background: C.warmBg, border: "1px solid #fde68a" }}>
        <div style={{ fontSize: 13, fontWeight: 600, color: C.warm, marginBottom: 4 }}>ğŸ“Œ Conditions, avantages & candidature</div>
        <p style={{ fontSize: 13, color: "#78350f", margin: 0, lineHeight: 1.6 }}>DerniÃ¨re partie. Transparence, prÃ©cision et cohÃ©rence RSE.</p>
      </Card>
      {CONDITIONS_FIELDS.map(f => (
        <div key={f.id} style={{ marginBottom: 20 }}>
          <div style={{ fontSize: 14, fontWeight: 600, color: C.text, marginBottom: 8 }}>{f.label}</div>
          <OptionPicker options={f.options} selected={ans[f.id]} onSelect={(val) => setAns(f.id, val)} />
        </div>
      ))}
      <div style={{ textAlign: "right" }}>
        <button onClick={onNext} disabled={!allDone} style={{ ...btnP, opacity: allDone ? 1 : 0.4 }}>Voir le bilan â†’</button>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BILAN (Avec correction dÃ©taillÃ©e)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function BilanPhase({ scoreTri, cAns, onRestart }) {
  const [tab, setTab] = useState("score"); // 'score', 'correction', 'rules'

  // Calcul du score de la phase Construction
  let scoreConst = 0;
  // Entete (max 8)
  ENTETE_FIELDS.forEach(f => { if (f.options.find(o => o.id === cAns.entete[f.id])?.correct) scoreConst += 2; });
  // Pres (max 6)
  const presGood = PRESENTATION_BLOCKS.filter(b => b.good).map(b => b.id);
  const presPts = Math.max(0, cAns.pres.filter(id => presGood.includes(id)).length * 2 - cAns.pres.filter(id => !presGood.includes(id)).length);
  scoreConst += presPts;
  // Missions (max 10)
  MISSIONS_BUILD.forEach(m => { if (m.versions.find(v => v.id === cAns.missions[m.id])?.correct) scoreConst += 2; });
  // Profil (max 10)
  PROFIL_ITEMS.forEach(i => { if (cAns.profil[i.id] === i.category) scoreConst += 1; });
  // Conditions (max 8)
  CONDITIONS_FIELDS.forEach(f => { if (f.options.find(o => o.id === cAns.conditions[f.id])?.correct) scoreConst += 2; });

  const maxConst = 42;
  const total = scoreTri + scoreConst;
  const max = 8 + maxConst;
  const pct = Math.round((total / max) * 100);

  const grade = pct >= 85 ? { label: "Expert(e) en rÃ©daction", emoji: "ğŸ†", color: "#b45309" }
    : pct >= 65 ? { label: "Bon(ne) rÃ©dacteur(trice)", emoji: "ğŸ¯", color: C.ok }
      : pct >= 40 ? { label: "En progression", emoji: "ğŸ“ˆ", color: C.warm }
        : { label: "Ã€ approfondir", emoji: "ğŸ“š", color: C.err };

  // Helper pour afficher une erreur de correction
  const CorrectionItem = ({ title, status, desc, why }) => (
    <div style={{ background: status ? C.okBg : C.errBg, border: `1px solid ${status ? C.okBorder : C.errBorder}`, padding: "12px 16px", borderRadius: 10, marginBottom: 12 }}>
      <div style={{ fontSize: 13, fontWeight: 700, color: status ? "#065f46" : "#991b1b", marginBottom: 4 }}>{title}</div>
      <div style={{ fontSize: 13, color: C.text, marginBottom: why ? 6 : 0 }}>{desc}</div>
      {why && <div style={{ fontSize: 12, color: status ? "#065f46" : "#991b1b", fontStyle: "italic", borderTop: `1px solid ${status ? C.okBorder : C.errBorder}`, paddingTop: 6, marginTop: 6 }}>{why}</div>}
    </div>
  );

  return (
    <div style={{ maxWidth: 700, margin: "0 auto" }}>
      <div style={{ textAlign: "center", marginBottom: 24 }}>
        <div style={{ fontSize: 56, marginBottom: 8 }}>{grade.emoji}</div>
        <h2 style={{ fontFamily: "'Fraunces',serif", color: grade.color, fontSize: 26, marginBottom: 6 }}>{grade.label}</h2>
        <p style={{ color: C.textMuted, fontSize: 15 }}>Score total : <strong style={{ color: C.text, fontSize: 18 }}>{total}</strong> / {max} <span style={{ marginLeft: 8 }}>({pct}%)</span></p>
      </div>

      <div style={{ display: "flex", gap: 8, justifyContent: "center", marginBottom: 24 }}>
        {[
          { id: "score", label: "Mon Score" },
          { id: "correction", label: "Correction dÃ©taillÃ©e" },
          { id: "rules", label: "Les 5 rÃ¨gles d'or" }
        ].map(t => (
          <button key={t.id} onClick={() => setTab(t.id)} style={{
            padding: "8px 16px", borderRadius: 999, fontSize: 13, fontWeight: 600, border: "none", cursor: "pointer",
            background: tab === t.id ? C.accent : C.borderLight, color: tab === t.id ? "#fff" : C.textMuted
          }}>
            {t.label}
          </button>
        ))}
      </div>

      {tab === "score" && (
        <div className="fadeSlide">
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14, marginBottom: 24 }}>
            {[
              { k: "tri", icon: "ğŸ”", label: "Tri express", score: scoreTri, max: 8 },
              { k: "const", icon: "ğŸ—ï¸", label: "Construction", score: scoreConst, max: maxConst }
            ].map((item) => {
              const p = Math.round((item.score / item.max) * 100);
              return (
                <Card key={item.k}>
                  <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}><span style={{ fontSize: 22 }}>{item.icon}</span><span style={{ fontSize: 14, fontWeight: 600, color: C.text }}>{item.label}</span></div>
                  <div style={{ fontSize: 12, color: C.textMuted, marginBottom: 6 }}>{item.score} / {item.max} points</div>
                  <div style={{ width: "100%", background: C.borderLight, borderRadius: 999, height: 8, overflow: "hidden" }}>
                    <div style={{ width: `${p}%`, height: "100%", background: p >= 70 ? C.ok : p >= 40 ? C.warm : C.err, borderRadius: 999 }} />
                  </div>
                </Card>
              );
            })}
          </div>
          <div style={{ textAlign: "center", marginTop: 40 }}>
            <button onClick={() => setTab("correction")} style={{ ...btnP, background: C.white, color: C.accent, border: `2px solid ${C.accent}` }}>Voir mes erreurs â†’</button>
          </div>
        </div>
      )}

      {tab === "correction" && (
        <div className="fadeSlide">
          <Card style={{ marginBottom: 20 }}>
            <h3 style={{ fontSize: 16, color: C.text, margin: "0 0 16px" }}>En-tÃªte</h3>
            {ENTETE_FIELDS.map(f => {
              const userOpt = f.options.find(o => o.id === cAns.entete[f.id]);
              const correctOpt = f.options.find(o => o.correct);
              const ok = userOpt?.correct;
              return <CorrectionItem key={f.id} title={f.label} status={ok} desc={ok ? userOpt.text : <>Votre choix : {userOpt?.text || "Aucun"}<br />Attendu : {correctOpt.text}</>} why={userOpt?.why} />
            })}
          </Card>
          <Card style={{ marginBottom: 20 }}>
            <h3 style={{ fontSize: 16, color: C.text, margin: "0 0 16px" }}>Missions</h3>
            {MISSIONS_BUILD.map(m => {
              const userOpt = m.versions.find(o => o.id === cAns.missions[m.id]);
              const correctOpt = m.versions.find(o => o.correct);
              const ok = userOpt?.correct;
              return <CorrectionItem key={m.id} title={m.slot} status={ok} desc={ok ? userOpt.text : <>Votre choix : {userOpt?.text || "Aucun"}<br />Attendu : {correctOpt.text}</>} why={userOpt?.why} />
            })}
          </Card>
          <Card style={{ marginBottom: 20 }}>
            <h3 style={{ fontSize: 16, color: C.text, margin: "0 0 16px" }}>Profil</h3>
            {PROFIL_ITEMS.map(i => {
              const userCat = cAns.profil[i.id];
              const ok = userCat === i.category;
              return <CorrectionItem key={i.id} title={i.text} status={ok} desc={ok ? `Bien classÃ© dans : ${i.category}` : `Vous l'avez classÃ© : ${userCat || "Non classÃ©"} | Attendu : ${i.category}`} why={i.fix ? `Reformulation conseillÃ©e : ${i.fix}` : null} />
            })}
          </Card>
        </div>
      )}

      {tab === "rules" && (
        <div className="fadeSlide">
          <Card style={{ background: C.warmBg, border: "1px solid #fde68a" }}>
            <div style={{ fontSize: 15, fontWeight: 700, color: C.warm, marginBottom: 12 }}>ğŸ“Œ Les 5 rÃ¨gles d'or</div>
            <div style={{ fontSize: 14, color: "#78350f", lineHeight: 1.8 }}>
              {[
                ["SincÃ©ritÃ© = rÃ©tention", "une annonce alignÃ©e sur la rÃ©alitÃ© Ã©vite les dÃ©parts prÃ©coces."],
                ["ZÃ©ro discrimination", "chaque critÃ¨re discriminant doit Ãªtre remplacÃ© par la compÃ©tence rÃ©elle visÃ©e."],
                ["La RSE se prouve", "des faits chiffrÃ©s et vÃ©rifiables, jamais des slogans."],
                ["ClartÃ© = candidatures qualifiÃ©es", "missions prÃ©cises, fourchette salariale, processus transparent."],
                ["C'est la loi", "discrimination Ã  l'embauche = jusqu'Ã  45 000 â‚¬ d'amende et 3 ans d'emprisonnement."],
              ].map(([t, d], i) => <p key={i} style={{ margin: "0 0 10px" }}><strong style={{ color: "#92400e" }}>{i + 1}. {t} :</strong> {d}</p>)}
            </div>
          </Card>
        </div>
      )}

      <div style={{ textAlign: "center", marginTop: 30, paddingTop: 20, borderTop: `1px solid ${C.border}` }}>
        <button onClick={onRestart} style={{ padding: "8px 24px", borderRadius: 8, fontSize: 14, cursor: "pointer", background: C.borderLight, color: C.text, border: "none", fontWeight: 600 }}>ğŸ”„ Recommencer l'exercice</button>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN (Navigation via Tabs)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
export default function App() {
  const [phase, setPhase] = useState(0); // 0: Intro, 1: Tri, 2: Const, 3: Bilan

  // Ã‰tats partagÃ©s pour persistance lors de la navigation
  const [scoreTri, setScoreTri] = useState(0);
  const [cAns, setCAns] = useState({
    entete: {},
    pres: [],
    missions: {},
    profil: {},
    conditions: {}
  });

  const restart = () => {
    setPhase(0);
    setScoreTri(0);
    setCAns({ entete: {}, pres: [], missions: {}, profil: {}, conditions: {} });
  };

  return (
    <div style={{ minHeight: "100vh", background: C.bg, fontFamily: "'Plus Jakarta Sans',sans-serif", color: C.text }}>
      <style>{`
         @import url('https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
         .fadeSlide { animation: fadeSlideIn 0.4s forwards; }
         @keyframes fadeSlideIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
         * { box-sizing:border-box; }
       `}</style>
      <div style={{ maxWidth: 900, margin: "0 auto", padding: "32px 24px" }}>

        {/* Navigation Tabs */}
        {phase > 0 && (
          <div style={{ marginBottom: 28 }}>
            <div style={{ display: "flex", gap: 6, marginBottom: 8, flexWrap: "wrap" }}>
              {PHASES.slice(1).map((p, i) => {
                const stepIdx = i + 1; // 1, 2, 3
                return (
                  <div key={p.id} onClick={() => setPhase(stepIdx)} style={{
                    fontSize: 12, fontWeight: 600, padding: "6px 14px", borderRadius: 999, cursor: "pointer", transition: "all 0.2s",
                    background: stepIdx === phase ? C.accent : C.borderLight,
                    color: stepIdx === phase ? "#fff" : C.textMuted,
                  }}>
                    {p.label}
                  </div>
                );
              })}
            </div>
            <div style={{ width: "100%", background: C.borderLight, borderRadius: 999, height: 6, overflow: "hidden" }}>
              <div style={{
                width: `${Math.round((phase / (PHASES.length - 1)) * 100)}%`, height: "100%",
                background: `linear-gradient(90deg,${C.accent},#818cf8)`, borderRadius: 999,
                transition: "width 0.4s cubic-bezier(.4,0,.2,1)"
              }} />
            </div>
          </div>
        )}

        {/* Container principal. On utilise 'display' au lieu de destruction conditionnelle pour conserver l'Ã©tat de TriPhase et ConstructionPhase */}
        <div style={{ display: phase === 0 ? "block" : "none" }}>
          <IntroPhase onNext={() => setPhase(1)} />
        </div>
        <div style={{ display: phase === 1 ? "block" : "none" }}>
          <TriPhase onNext={() => setPhase(2)} score={scoreTri} setScore={setScoreTri} />
        </div>
        <div style={{ display: phase === 2 ? "block" : "none" }}>
          <ConstructionPhase onNext={() => setPhase(3)} cAns={cAns} setCAns={setCAns} />
        </div>
        <div style={{ display: phase === 3 ? "block" : "none" }}>
          <BilanPhase scoreTri={scoreTri} cAns={cAns} onRestart={restart} />
        </div>

      </div>
    </div>
  );
}
